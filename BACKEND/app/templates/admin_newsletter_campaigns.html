<!-- Tailwind Configuration Script -->
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    'syne': ['Syne', 'sans-serif'],
                },
                colors: {
                    'base': 'var(--base)',
                    'base-tint': 'var(--base-tint)',
                    'base-shade': 'var(--base-shade)',
                    'accent': 'var(--accent)',
                    'secondary': 'var(--secondary)',
                    'secondary-rgba': 'var(--secondary-rgba)',
                    'stroke-controls': 'var(--stroke-controls)',
                    'stroke-elements': 'var(--stroke-elements)',
                    't-bright': 'var(--t-bright)',
                    't-medium': 'var(--t-medium)',
                    't-muted': 'var(--t-muted)',
                    't-accent': 'var(--t-accent)',
                    't-secondary': 'var(--t-secondary)',
                    't-disabled': 'var(--t-disabled)',
                    't-placeholder': 'var(--t-placeholder)',
                    'base-opp': 'var(--base-opp)',
                    't-opp-bright': 'var(--t-opp-bright)',
                    't-opp-medium': 'var(--t-opp-medium)',
                    't-opp-muted': 'var(--t-opp-muted)',
                    'gradient-one': 'var(--gradient-one)',
                    'gradient-two': 'var(--gradient-two)',
                    'gradient-three': 'var(--gradient-three)',
                },
                borderRadius: {
                    's': 'var(--_radius-s)',
                    'm': 'var(--_radius-m)',
                    'l': 'var(--_radius-l)',
                    'xl': 'var(--_radius-xl)',
                },
                animation: {
                    'fade-in': 'fadeIn 0.6s ease-out forwards',
                    'slide-up': 'slideUp 0.6s ease-out forwards',
                    'scale-in': 'scaleIn 0.4s ease-out forwards',
                },
                transitionTimingFunction: {
                    'bezier': 'var(--_animbezier)',
                },
                transitionDuration: {
                    'fast': 'var(--_animspeed-fast)',
                    'medium': 'var(--_animspeed-medium)',
                    'slow': 'var(--_animspeed-slow)',
                },
            },
        },
    }
</script>

<div
    class="min-h-screen bg-gradient-to-br from-gradient-one via-base to-gradient-two dark:from-base dark:via-base-tint dark:to-base-shade transition-all duration-medium overflow-x-hidden">
    <div class="p-4 md:p-6 lg:p-8 max-w-full">
        <!-- Page Header -->
        <div
            class="text-center mb-12 p-12 bg-gradient-to-r from-accent via-secondary to-t-accent rounded-xl text-t-opp-bright shadow-2xl hover:shadow-3xl transform hover:scale-[1.01] transition-all duration-medium relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-accent/20 via-transparent to-secondary/20 animate-pulse">
            </div>
            <div class="relative z-10">
                <h1
                    class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight font-syne bg-gradient-to-r from-t-opp-bright via-white to-t-opp-medium bg-clip-text text-transparent">
                    Campaign Management</h1>
                <p class="text-xl md:text-2xl opacity-90 font-syne font-light">Create, schedule, and manage your email
                    campaigns with advanced automation</p>
                <div class="mt-8 flex justify-center">
                    <div
                        class="w-24 h-1 bg-gradient-to-r from-transparent via-t-opp-bright to-transparent rounded-full">
                    </div>
                </div>
            </div>
        </div>

        <!-- Campaign Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8 mb-12">
            <!-- Total Campaigns Card -->
            <div
                class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-accent/20 cursor-pointer overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-accent/5 via-transparent to-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium">
                </div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div
                        class="w-16 h-16 bg-gradient-to-br from-accent via-secondary to-t-accent rounded-xl flex items-center justify-center text-t-opp-bright text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-envelope"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="totalCampaigns">0</div>
                        <div class="text-base text-t-medium font-syne mb-3">Total Campaigns</div>
                        <div
                            class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+12.5%</span>
                            <span class="text-t-muted font-syne">this month</span>
                        </div>
                    </div>
                </div>
                <div
                    class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-accent/10 to-secondary/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium">
                </div>
            </div>

            <!-- Active Campaigns Card -->
            <div
                class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-emerald-500/20 cursor-pointer overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-teal-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium">
                </div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div
                        class="w-16 h-16 bg-gradient-to-br from-emerald-500 via-teal-500 to-green-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-play-circle"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="activeCampaigns">0</div>
                        <div class="text-base text-t-medium font-syne mb-3">Active Campaigns</div>
                        <div
                            class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+8.2%</span>
                            <span class="text-t-muted font-syne">this month</span>
                        </div>
                    </div>
                </div>
                <div
                    class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-emerald-500/10 to-teal-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium">
                </div>
            </div>

            <!-- Scheduled Campaigns Card -->
            <div
                class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-blue-500/20 cursor-pointer overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-blue-500/5 via-transparent to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium">
                </div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div
                        class="w-16 h-16 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-clock"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="scheduledCampaigns">0</div>
                        <div class="text-base text-t-medium font-syne mb-3">Scheduled</div>
                        <div class="flex items-center space-x-2 text-sm font-semibold text-blue-500 dark:text-blue-400">
                            <i class="ph-bold ph-calendar text-base"></i>
                            <span>Next: 2h</span>
                        </div>
                    </div>
                </div>
                <div
                    class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium">
                </div>
            </div>

            <!-- Average Open Rate Card -->
            <div
                class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-yellow-500/20 cursor-pointer overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-br from-yellow-500/5 via-transparent to-amber-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium">
                </div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div
                        class="w-16 h-16 bg-gradient-to-br from-yellow-500 via-amber-500 to-orange-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-chart-bar"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="avgOpenRate">0%</div>
                        <div class="text-base text-t-medium font-syne mb-3">Avg. Open Rate</div>
                        <div
                            class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+5.7%</span>
                            <span class="text-t-muted font-syne">vs last month</span>
                        </div>
                    </div>
                </div>
                <div
                    class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-yellow-500/10 to-amber-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium">
                </div>
            </div>
        </div>

        <!-- Campaign Management -->
        <div
            class="bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl mb-12 overflow-hidden hover:shadow-3xl transition-all duration-medium">
            <div
                class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                <div class="flex flex-col xl:flex-row xl:items-center xl:justify-between space-y-6 xl:space-y-0">
                    <div class="flex items-center space-x-4">
                        <div
                            class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                            <i class="ph-bold ph-megaphone text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-t-bright font-syne">Campaign Management</h3>
                            <p class="text-t-medium font-syne text-sm">Create, edit, and monitor your email campaigns
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                        <button
                            class="inline-flex items-center justify-center space-x-3 px-8 py-4 bg-gradient-to-r from-accent via-secondary to-t-accent hover:from-accent/90 hover:via-secondary/90 hover:to-t-accent/90 text-t-opp-bright font-semibold rounded-xl shadow-xl hover:shadow-2xl transform hover:-translate-y-1 hover:scale-105 transition-all duration-medium font-syne"
                            id="createCampaignBtn">
                            <i class="ph-bold ph-plus text-lg"></i>
                            <span>Create Campaign</span>
                        </button>
                        <button
                            class="inline-flex items-center justify-center space-x-3 px-8 py-4 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements text-t-bright font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 hover:scale-105 transition-all duration-medium font-syne"
                            id="importCampaignsBtn">
                            <i class="ph-bold ph-upload text-lg"></i>
                            <span>Import</span>
                        </button>
                        <button
                            class="inline-flex items-center justify-center space-x-3 px-8 py-4 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements text-t-bright font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 hover:scale-105 transition-all duration-medium font-syne"
                            id="exportCampaignsBtn">
                            <i class="ph-bold ph-download text-lg"></i>
                            <span>Export</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="p-4 md:p-6 lg:p-8 border-b border-stroke-elements">
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 md:gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-t-bright font-syne">Search Campaigns</label>
                        <div class="relative">
                            <input type="text"
                                class="w-full pl-10 pr-4 py-3 bg-base dark:bg-base-tint border border-stroke-elements rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-medium text-t-bright placeholder-t-muted"
                                id="searchCampaigns" placeholder="Search by name, subject...">
                            <i
                                class="ph-bold ph-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-t-muted"></i>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-t-bright font-syne">Status</label>
                        <div class="relative">
                            <select
                                class="w-full pl-10 pr-10 py-3 bg-base dark:bg-base-tint border border-stroke-elements rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-medium text-t-bright appearance-none cursor-pointer"
                                id="statusFilter">
                                <option value="">All Statuses</option>
                                <option value="draft">Draft</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="sending">Sending</option>
                                <option value="sent">Sent</option>
                                <option value="paused">Paused</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                            <i
                                class="ph-bold ph-check-circle absolute left-3 top-1/2 transform -translate-y-1/2 text-t-muted"></i>
                            <i
                                class="ph-bold ph-caret-down absolute right-3 top-1/2 transform -translate-y-1/2 text-t-muted pointer-events-none"></i>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-t-bright font-syne">Type</label>
                        <div class="relative">
                            <select
                                class="w-full pl-10 pr-10 py-3 bg-base dark:bg-base-tint border border-stroke-elements rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-medium text-t-bright appearance-none cursor-pointer"
                                id="typeFilter">
                                <option value="">All Types</option>
                                <option value="newsletter">Newsletter</option>
                                <option value="promotional">Promotional</option>
                                <option value="transactional">Transactional</option>
                                <option value="welcome">Welcome</option>
                                <option value="reengagement">Re-engagement</option>
                            </select>
                            <i
                                class="ph-bold ph-tag absolute left-3 top-1/2 transform -translate-y-1/2 text-t-muted"></i>
                            <i
                                class="ph-bold ph-caret-down absolute right-3 top-1/2 transform -translate-y-1/2 text-t-muted pointer-events-none"></i>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-t-bright font-syne">Date Range</label>
                        <div class="relative">
                            <select
                                class="w-full pl-10 pr-10 py-3 bg-base dark:bg-base-tint border border-stroke-elements rounded-xl focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-medium text-t-bright appearance-none cursor-pointer"
                                id="dateFilter">
                                <option value="">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                                <option value="year">This Year</option>
                            </select>
                            <i
                                class="ph-bold ph-calendar absolute left-3 top-1/2 transform -translate-y-1/2 text-t-muted"></i>
                            <i
                                class="ph-bold ph-caret-down absolute right-3 top-1/2 transform -translate-y-1/2 text-t-muted pointer-events-none"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Campaigns Table -->
            <div class="overflow-x-auto w-full">
                <table class="w-full table-fixed min-w-[600px]" id="campaignsTable">
                    <thead class="bg-base-tint/50 dark:bg-base-shade/50">
                        <tr class="border-b border-stroke-elements">
                            <th class="w-12 px-2 md:px-4 py-3 md:py-4 text-left">
                                <input type="checkbox" id="selectAllCampaigns"
                                    class="w-4 h-4 text-accent bg-base dark:bg-base-tint border-2 border-stroke-elements rounded focus:ring-2 focus:ring-accent focus:ring-offset-0 cursor-pointer">
                            </th>
                            <th
                                class="w-40 md:w-48 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Campaign</th>
                            <th
                                class="w-24 md:w-28 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Status</th>
                            <th
                                class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Type</th>
                            <th
                                class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Recipients</th>
                            <th
                                class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Sent</th>
                            <th
                                class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Open Rate</th>
                            <th
                                class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-left text-xs font-bold text-t-bright uppercase tracking-wider font-syne">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody id="campaignsTableBody" class="divide-y divide-stroke-elements">
                        <!-- Campaign data will be populated here -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div
                class="px-4 md:px-6 lg:px-8 py-4 md:py-6 bg-base-tint/30 dark:bg-base-shade/30 border-t border-stroke-elements">
                <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                    <div class="text-xs md:text-sm text-t-medium font-syne">
                        Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span
                            id="totalRecords">0</span> campaigns
                    </div>
                    <div class="flex items-center space-x-2">
                        <button
                            class="px-3 md:px-4 py-2 bg-base-tint dark:bg-base-shade border border-stroke-elements rounded-lg text-t-bright hover:bg-base-shade dark:hover:bg-base transition-all duration-medium disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            id="prevPage" disabled>
                            <i class="ph-bold ph-caret-left"></i>
                        </button>
                        <span class="px-3 md:px-4 py-2 text-t-bright font-syne text-sm" id="currentPage">1</span>
                        <button
                            class="px-3 md:px-4 py-2 bg-base-tint dark:bg-base-shade border border-stroke-elements rounded-lg text-t-bright hover:bg-base-shade dark:hover:bg-base transition-all duration-medium disabled:opacity-50 disabled:cursor-not-allowed text-sm"
                            id="nextPage">
                            <i class="ph-bold ph-caret-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Actions Panel (Hidden by default) -->
        <div class="bg-accent/10 border border-accent/20 rounded-xl p-6 mb-8 hidden" id="bulkActionsPanel">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="ph-bold ph-stack text-accent text-xl"></i>
                    <span class="text-t-bright font-syne font-semibold" id="selectedCount">0 campaigns selected</span>
                </div>
                <div class="flex items-center space-x-3">
                    <button
                        class="inline-flex items-center justify-center space-x-2 px-4 py-2 bg-accent/20 hover:bg-accent/30 text-accent font-semibold rounded-lg transition-all duration-medium font-syne text-sm"
                        id="bulkDuplicateBtn">
                        <i class="ph-bold ph-copy text-sm"></i>
                        <span>Duplicate</span>
                    </button>
                    <button
                        class="inline-flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-500 font-semibold rounded-lg transition-all duration-medium font-syne text-sm"
                        id="bulkScheduleBtn">
                        <i class="ph-bold ph-clock text-sm"></i>
                        <span>Schedule</span>
                    </button>
                    <button
                        class="inline-flex items-center justify-center space-x-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-500 font-semibold rounded-lg transition-all duration-medium font-syne text-sm"
                        id="bulkDeleteBtn">
                        <i class="ph-bold ph-trash text-sm"></i>
                        <span>Delete</span>
                    </button>
                    <button
                        class="inline-flex items-center justify-center space-x-2 px-4 py-2 bg-base-tint dark:bg-base-shade border border-stroke-elements text-t-bright font-semibold rounded-lg transition-all duration-medium font-syne text-sm"
                        id="clearSelectionBtn">
                        <i class="ph-bold ph-x text-sm"></i>
                        <span>Clear</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Wizard Modal -->
<div id="campaignWizardModal" class="fixed inset-0 z-50 hidden"
    style="background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px);">
    <div class="absolute inset-0 flex items-center justify-center p-4">
        <div
            class="bg-base dark:bg-base border border-stroke-elements rounded-xl shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col overflow-hidden theme-card">

            <!-- Wizard Header -->
            <div class="px-8 py-5 border-b border-stroke-elements bg-base-tint flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-t-bright font-syne">Create Campaign</h3>
                    <p class="text-sm text-t-medium">Step <span id="currentStepNum">1</span> of 4: <span
                            id="currentStepName">Setup</span></p>
                </div>
                <button onclick="closeWizard()" class="text-t-medium hover:text-t-bright p-2">
                    <i class="ph-bold ph-x text-xl"></i>
                </button>
            </div>

            <!-- Wizard Progress Bar -->
            <div class="w-full bg-base-shade h-1">
                <div id="wizardProgress" class="h-full bg-accent transition-all duration-500 ease-out"
                    style="width: 25%"></div>
            </div>

            <!-- Wizard Body -->
            <div class="flex-1 overflow-hidden relative">

                <!-- STEP 1: SETUP -->
                <div id="step1" class="wizard-step absolute inset-0 p-8 overflow-y-auto">
                    <div class="max-w-2xl mx-auto space-y-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-t-bright">Campaign Name (Internal)</label>
                            <input type="text" id="campName"
                                class="w-full px-4 py-3 rounded-lg bg-base border border-stroke-controls text-t-bright focus:border-accent outline-none transition-colors"
                                placeholder="e.g. January Newsletter">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-t-bright">Email Subject Line</label>
                            <input type="text" id="campSubject"
                                class="w-full px-4 py-3 rounded-lg bg-base border border-stroke-controls text-t-bright focus:border-accent outline-none transition-colors"
                                placeholder="e.g. 5 Trends You Need to Know">
                        </div>
                        <div class="grid grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-t-bright">Sender Name</label>
                                <input type="text" value="NekwasaR Team"
                                    class="w-full px-4 py-3 rounded-lg bg-base-tint border border-stroke-controls text-t-muted cursor-not-allowed"
                                    disabled>
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-t-bright">Sender Email</label>
                                <input type="text" value="newsletter@nekwasar.com"
                                    class="w-full px-4 py-3 rounded-lg bg-base-tint border border-stroke-controls text-t-muted cursor-not-allowed"
                                    disabled>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STEP 2: SELECT TEMPLATE -->
                <div id="step2"
                    class="wizard-step absolute inset-0 p-8 overflow-y-auto hidden translate-x-full transition-transform">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="wizardTemplateGrid">
                        <!-- Templates injected here -->
                    </div>
                </div>

                <!-- STEP 3: VISUAL EDITOR -->
                <div id="step3"
                    class="wizard-step absolute inset-0 flex flex-col hidden translate-x-full transition-transform">
                    <div
                        class="bg-base-tint p-2 flex justify-center text-xs text-t-medium border-b border-stroke-elements">
                        <span class="flex items-center gap-2"><i class="ph-bold ph-info"></i> Click directly on the
                            preview text to edit content.</span>
                    </div>
                    <div class="flex-1 bg-gray-100 p-8 overflow-y-auto flex justify-center">
                        <div id="visualEditorContainer" class="bg-white shadow-xl w-full max-w-[600px] min-h-[800px]"
                            contenteditable="true" style="outline: none;">
                            <!-- Template Content Injected Here -->
                        </div>
                    </div>
                </div>

                <!-- STEP 4: SUMMARY & PREVIEW -->
                <div id="step4"
                    class="wizard-step absolute inset-0 flex flex-col hidden translate-x-full transition-transform">
                    <div class="flex-1 flex overflow-hidden">
                        <!-- Left: Preview -->
                        <div class="flex-1 bg-gray-200 p-8 overflow-y-auto flex flex-col items-center">
                            <div class="text-xs text-gray-500 mb-2 font-bold uppercase tracking-wider">Email Preview
                            </div>
                            <iframe id="finalPreviewFrame"
                                class="w-full max-w-[600px] h-full bg-white shadow-2xl rounded-lg border-none"
                                sandbox="allow-same-origin"></iframe>
                        </div>

                        <!-- Right: Metadata & Confirm -->
                        <div class="w-96 bg-base border-l border-stroke-elements p-8 flex flex-col justify-between">
                            <div class="space-y-6">
                                <div>
                                    <h4 class="text-lg font-bold text-t-bright mb-4">Campaign Summary</h4>

                                    <div class="space-y-4">
                                        <div class="p-4 bg-base-tint rounded-lg border border-stroke-elements">
                                            <div class="text-xs text-t-medium uppercase tracking-wide mb-1">Subject
                                            </div>
                                            <div class="font-medium text-t-bright" id="summarySubject">...</div>
                                        </div>

                                        <div class="p-4 bg-base-tint rounded-lg border border-stroke-elements">
                                            <div class="text-xs text-t-medium uppercase tracking-wide mb-1">Audience
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="font-medium text-t-bright">All Subscribers</span>
                                                <span
                                                    class="bg-accent/10 text-accent px-2 py-0.5 rounded text-xs font-bold"
                                                    id="summaryCount">0</span>
                                            </div>
                                        </div>

                                        <div class="p-4 bg-base-tint rounded-lg border border-stroke-elements">
                                            <div class="text-xs text-t-medium uppercase tracking-wide mb-1">Estimated
                                                Send Time</div>
                                            <div class="font-medium text-t-bright">Immediate</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button onclick="submitCampaign()"
                                class="w-full py-4 bg-gradient-to-r from-accent to-secondary hover:from-accent/90 hover:to-secondary/90 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all flex items-center justify-center gap-2 group">
                                <i class="ph-bold ph-paper-plane-tilt group-hover:animate-pulse"></i>
                                Send Now
                            </button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Wizard Footer -->
            <div class="px-8 py-5 border-t border-stroke-elements bg-base flex justify-between items-center">
                <button onclick="prevStep()" id="prevBtn"
                    class="px-6 py-2 border border-stroke-controls rounded-lg text-t-medium hover:text-t-bright disabled:opacity-30 disabled:cursor-not-allowed">Previous</button>
                <button onclick="nextStep()" id="nextBtn"
                    class="px-6 py-2 bg-t-bright text-base-opp font-bold rounded-lg hover:bg-t-bright/90">Next
                    Step</button>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for enhanced animations and effects -->
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @keyframes glow {

        0%,
        100% {
            box-shadow: 0 0 20px rgba(var(--accent), 0.3);
        }

        50% {
            box-shadow: 0 0 30px rgba(var(--accent), 0.6);
        }
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
    }

    .animate-scale-in {
        animation: scaleIn 0.4s ease-out forwards;
    }

    .animate-glow {
        animation: glow 2s ease-in-out infinite;
    }

    /* Enhanced scrollbar */
    .overflow-x-auto::-webkit-scrollbar,
    .overflow-y-auto::-webkit-scrollbar {
        width: 8px;
    }

    .overflow-x-auto::-webkit-scrollbar-track,
    .overflow-y-auto::-webkit-scrollbar-track {
        background: var(--base-tint);
        border-radius: 4px;
    }

    .overflow-x-auto::-webkit-scrollbar-thumb,
    .overflow-y-auto::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 4px;
    }

    .overflow-x-auto::-webkit-scrollbar-thumb:hover,
    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
        background: var(--secondary);
    }

    /* Enhanced focus states */
    .focus\:ring-accent:focus {
        --tw-ring-color: var(--accent);
    }

    /* Smooth transitions for all interactive elements */
    button,
    input,
    select,
    .cursor-pointer {
        transition: all var(--_animspeed-medium) var(--_animbezier);
    }

    /* Enhanced hover effects */
    .hover\:glow:hover {
        animation: glow 0.6s ease-out;
    }

    /* Campaign status badges */
    .status-draft {
        @apply bg-gray-500/10 text-gray-500 border-gray-500/20;
    }

    .status-scheduled {
        @apply bg-blue-500/10 text-blue-500 border-blue-500/20;
    }

    .status-sending {
        @apply bg-yellow-500/10 text-yellow-500 border-yellow-500/20;
    }

    .status-sent {
        @apply bg-green-500/10 text-green-500 border-green-500/20;
    }

    .status-paused {
        @apply bg-orange-500/10 text-orange-500 border-orange-500/20;
    }

    .status-cancelled {
        @apply bg-red-500/10 text-red-500 border-red-500/20;
    }

    /* Campaign type badges */
    .type-newsletter {
        @apply bg-purple-500/10 text-purple-500 border-purple-500/20;
    }

    .type-promotional {
        @apply bg-pink-500/10 text-pink-500 border-pink-500/20;
    }

    .type-transactional {
        @apply bg-indigo-500/10 text-indigo-500 border-indigo-500/20;
    }

    .type-welcome {
        @apply bg-emerald-500/10 text-emerald-500 border-emerald-500/20;
    }

    .type-reengagement {
        @apply bg-amber-500/10 text-amber-500 border-amber-500/20;
    }
</style>

<script>
    // Newsletter Campaigns Page
    let allCampaigns = [];
    let currentPage = 1;
    let pageSize = 25;
    let selectedCampaigns = new Set();
    let wizardStep = 1;
    let campaignData = {
        name: '',
        subject: '',
        templateId: null,
        htmlContent: ''
    };
    let allTemplates = []; // Will be loaded from API

    function initNewsletterCampaigns() {
        loadCampaignData();
        setupEventListeners();
        setupBulkActions();

        // Explicitly make createCampaign global so it can be called from sidebar or other places
        window.createCampaign = openWizard;
    }

    // --- Wizard Navigation ---
    function openWizard() {
        document.getElementById('campaignWizardModal').classList.remove('hidden');
        resetWizard();
        loadTemplatesForWizard();
    }

    function closeWizard() {
        document.getElementById('campaignWizardModal').classList.add('hidden');
    }

    function resetWizard() {
        wizardStep = 1;
        campaignData = { name: '', subject: '', templateId: null, htmlContent: '' };
        document.getElementById('campName').value = '';
        document.getElementById('campSubject').value = '';

        // Reset visual editor
        document.getElementById('visualEditorContainer').innerHTML = '';

        // Hide all steps except step 1
        document.getElementById('step1').classList.remove('hidden');
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('step3').classList.add('hidden');
        document.getElementById('step4').classList.add('hidden');

        updateWizardUI();
    }

    function nextStep() {
        if (!validateStep(wizardStep)) return;

        if (wizardStep === 1) {
            // Just moving to select template
        }

        if (wizardStep === 2) {
            // Capture chosen template content for editing
            const tpl = allTemplates.find(t => t.id === campaignData.templateId);
            if (tpl) {
                // Initialize Visual Editor
                document.getElementById('visualEditorContainer').innerHTML = tpl.content_template;
            }
        }

        if (wizardStep === 3) {
            // Capture edited content
            campaignData.htmlContent = document.getElementById('visualEditorContainer').innerHTML;

            // Setup Final Preview
            renderFinalPreview();
        }

        if (wizardStep < 4) {
            transitionStep(wizardStep, wizardStep + 1);
            wizardStep++;
            updateWizardUI();
        }
    }

    function prevStep() {
        if (wizardStep > 1) {
            transitionStep(wizardStep, wizardStep - 1);
            wizardStep--;
            updateWizardUI();
        }
    }

    function transitionStep(current, next) {
        document.getElementById(`step${current}`).classList.add('hidden');
        document.getElementById(`step${next}`).classList.remove('hidden');
    }

    function updateWizardUI() {
        // Step Indicators
        document.getElementById('currentStepNum').innerText = wizardStep;
        const names = ['Setup', 'Select Template', 'Edit Content', 'Review'];
        document.getElementById('currentStepName').innerText = names[wizardStep - 1];

        // Progress Bar
        document.getElementById('wizardProgress').style.width = `${wizardStep * 25}%`;

        // Buttons
        document.getElementById('prevBtn').disabled = (wizardStep === 1);
        const nextBtn = document.getElementById('nextBtn');
        if (wizardStep === 4) {
            nextBtn.classList.add('hidden');
        } else {
            nextBtn.classList.remove('hidden');
        }
    }

    function validateStep(step) {
        if (step === 1) {
            const name = document.getElementById('campName').value.trim();
            const subject = document.getElementById('campSubject').value.trim();
            if (!name || !subject) {
                alert('Please fill in all fields.');
                return false;
            }
            campaignData.name = name;
            campaignData.subject = subject;
        }
        if (step === 2) {
            if (!campaignData.templateId) {
                alert('Please select a template.');
                return false;
            }
        }
        return true;
    }

    // --- Templates Loading ---
    async function loadTemplatesForWizard() {
        try {
            const res = await fetch('/api/newsletter/admin/templates', {
                headers: { 'Authorization': `Bearer ${localStorage.getItem('token') || ''}` }
            });
            const data = await res.json();
            if (data.success && data.templates) {
                allTemplates = data.templates;
                await loadTemplateDetailsForCache(allTemplates);
                renderWizardTemplates(allTemplates);
            }
        } catch (e) { console.error("Template load failed", e); }
    }

    async function loadTemplateDetailsForCache(templates) {
        // Pre-fetch details (content) for each template so we have the HTML ready
        // In a real optimized app, we might fetch on demand, but this ensures smooth transition
        for (let t of templates) {
            try {
                const res = await fetch(`/api/newsletter/admin/templates/${t.id}`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token') || ''}` }
                });
                const data = await res.json();
                if (data.success) {
                    t.content_template = data.template.content_template;
                }
            } catch (e) { }
        }
    }

    function renderWizardTemplates(templates) {
        const grid = document.getElementById('wizardTemplateGrid');
        grid.innerHTML = templates.map(t => `
        <div onclick="selectTemplate(${t.id})" id="tpl-card-${t.id}" class="cursor-pointer border-2 border-transparent hover:border-accent rounded-xl bg-base-tint overflow-hidden transition-all text-left group">
            <div class="h-32 bg-gray-200 flex items-center justify-center relative overlow-hidden">
                 <i class="ph-bold ph-envelope-simple text-4xl text-gray-400 group-hover:scale-110 transition-transform"></i>
            </div>
            <div class="p-4">
                <h4 class="font-bold text-t-bright text-sm truncate">${t.name}</h4>
                <span class="text-xs text-t-medium uppercase tracking-wide">${t.category || 'General'}</span>
            </div>
        </div>
    `).join('');
    }

    function selectTemplate(id) {
        campaignData.templateId = id;
        // Visual selection state
        document.querySelectorAll('#wizardTemplateGrid > div').forEach(el => el.classList.remove('border-accent', 'ring-2', 'ring-accent'));
        document.getElementById(`tpl-card-${id}`).classList.add('border-accent', 'ring-2', 'ring-accent');
    }

    // --- Final Step Logic ---
    function renderFinalPreview() {
        // Iframe injection
        const frame = document.getElementById('finalPreviewFrame');
        // Ensure iframe is clear
        // We use srcdoc for modern browsers
        frame.srcdoc = campaignData.htmlContent;

        // Metadata
        document.getElementById('summarySubject').innerText = campaignData.subject;
        // Fetch real count
        const totalSubs = document.getElementById('totalSubscribers') ? document.getElementById('totalSubscribers').innerText : 'All Subscribers'; // Fallback
        document.getElementById('summaryCount').innerText = totalSubs;
    }

    async function submitCampaign() {
        try {
            const payload = {
                subject: campaignData.subject,
                content: campaignData.htmlContent,
                template_id: campaignData.templateId,
                template_type: 'custom', // Since it was edited
                scheduled_at: null // Immediate
            };

            const res = await fetch('/api/newsletter/admin/campaigns', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                },
                body: new URLSearchParams(payload)
            });

            const data = await res.json();

            if (data.success) {
                alert('Campaign Sent Successfully!');
                closeWizard();
                loadCampaignData(); // Refresh main list
            } else {
                alert('Failed: ' + data.message);
            }
        } catch (e) {
            console.error(e);
            alert('Error sending campaign. Check console.');
        }
    }

    // --- Standard Page Functions ---

    async function loadCampaignData() {
        try {
            const response = await fetch('/api/newsletter/admin/campaigns'); // Corrected endpoint if needed
            if (response.ok) {
                const data = await response.json();
                allCampaigns = data.campaigns || [];
                updateCampaignStats(data.stats);
                renderCampaigns();
            } else {
                // fallback
                console.log('API endpoints might not be fully ready, showing empty state');
            }
        } catch (error) {
            console.error('Error loading campaign data:', error);
        }
    }

    function updateCampaignStats(stats) {
        if (!stats) return;
        document.getElementById('totalCampaigns').textContent = stats.totalCampaigns || 0;
        document.getElementById('activeCampaigns').textContent = stats.activeCampaigns || 0;
        document.getElementById('scheduledCampaigns').textContent = stats.scheduledCampaigns || 0;
        document.getElementById('avgOpenRate').textContent = stats.avgOpenRate || '0%';
    }

    function renderCampaigns() {
        const tbody = document.getElementById('campaignsTableBody');
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const campaignsToShow = allCampaigns.slice(startIndex, endIndex);

        if (campaignsToShow.length === 0) {
            tbody.innerHTML = `
            <tr>
                <td colspan="8" class="px-4 md:px-8 py-8 md:py-16 text-center">
                    <div class="flex flex-col items-center space-y-4 md:space-y-6">
                        <div class="w-16 h-16 md:w-20 md:h-20 bg-base-tint dark:bg-base-shade rounded-2xl flex items-center justify-center shadow-xl mx-auto">
                            <i class="ph-bold ph-megaphone text-3xl md:text-5xl text-t-muted opacity-60"></i>
                        </div>
                        <div class="text-center space-y-2">
                            <h3 class="text-lg md:text-2xl font-bold text-t-bright font-syne">No campaigns found</h3>
                            <p class="text-sm md:text-base text-t-medium font-syne max-w-md">No campaigns match your current filters. Create your first campaign to get started.</p>
                        </div>
                    </div>
                </td>
            </tr>
        `;
            return;
        }

        tbody.innerHTML = campaignsToShow.map(campaign => `
        <tr class="hover:bg-base-tint/30 dark:hover:bg-base-shade/30 transition-all duration-medium group">
            <td class="w-12 px-2 md:px-4 py-3 md:py-4">
                <input type="checkbox" class="campaign-checkbox w-4 h-4 text-accent bg-base dark:bg-base-tint border-2 border-stroke-elements rounded focus:ring-2 focus:ring-accent focus:ring-offset-0 cursor-pointer" value="${campaign.id}" ${selectedCampaigns.has(campaign.id) ? 'checked' : ''}>
            </td>
            <td class="w-40 md:w-48 px-2 md:px-4 py-3 md:py-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-accent to-secondary rounded-lg flex items-center justify-center text-t-opp-bright text-xs font-bold shadow-lg flex-shrink-0">
                        ${getCampaignInitials(campaign.name || 'Campaign')}
                    </div>
                    <div class="min-w-0 flex-1">
                        <div class="text-xs font-semibold text-t-bright group-hover:text-accent transition-colors font-syne truncate">
                            ${campaign.name || 'Untitled'}
                        </div>
                        <div class="text-xs text-t-muted font-syne truncate">${campaign.subject || ''}</div>
                    </div>
                </div>
            </td>
            <td class="w-24 md:w-28 px-2 md:px-4 py-3 md:py-4">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold uppercase tracking-wide font-syne ${getStatusClass(campaign.status)} border">
                    ${formatStatus(campaign.status || 'draft')}
                </span>
            </td>
            <td class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold uppercase tracking-wide font-syne ${getTypeClass(campaign.type)} border">
                    ${formatType(campaign.type || 'standard')}
                </span>
            </td>
            <td class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-xs text-t-medium font-medium font-syne whitespace-nowrap">${formatNumber(campaign.recipientCount || 0)}</td>
            <td class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-xs text-t-medium font-medium font-syne whitespace-nowrap">${campaign.sentAt ? formatDate(campaign.sentAt) : '-'}</td>
            <td class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4 text-xs text-t-medium font-medium font-syne whitespace-nowrap">${campaign.openRate || 0}%</td>
            <td class="w-20 md:w-24 px-2 md:px-4 py-3 md:py-4">
                <div class="flex items-center space-x-1">
                    <button class="w-6 h-6 bg-accent/10 hover:bg-accent/20 text-accent rounded flex items-center justify-center transition-all duration-medium hover:scale-110 hover:shadow-lg" title="Edit Campaign" onclick="editCampaign('${campaign.id}')">
                        <i class="ph-bold ph-pencil text-xs"></i>
                    </button>
                    <!-- Other actions -->
                </div>
            </td>
        </tr>
    `).join('');

        updatePagination();
    }

    function getCampaignInitials(name) {
        if (!name) return 'C';
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    }

    function getStatusClass(status) {
        switch (status) {
            case 'draft': return 'status-draft';
            case 'scheduled': return 'status-scheduled';
            case 'sending': return 'status-sending';
            case 'sent': return 'status-sent';
            default: return 'status-draft';
        }
    }

    function getTypeClass(type) {
        return 'type-newsletter'; // Default for now
    }

    function formatStatus(status) {
        if (!status) return '-';
        return status.charAt(0).toUpperCase() + status.slice(1);
    }

    function formatType(type) {
        if (!type) return '-';
        return type.charAt(0).toUpperCase() + type.slice(1);
    }

    function formatNumber(num) {
        return new Intl.NumberFormat().format(num);
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric'
        });
    }

    function updatePagination() {
        const totalRecords = allCampaigns.length;
        const totalPages = Math.ceil(totalRecords / pageSize);
        const startRecord = (currentPage - 1) * pageSize + 1;
        const endRecord = Math.min(currentPage * pageSize, totalRecords);

        document.getElementById('showingStart').textContent = startRecord;
        document.getElementById('showingEnd').textContent = endRecord;
        document.getElementById('totalRecords').textContent = totalRecords;
        document.getElementById('currentPage').textContent = currentPage;

        const prevBtn = document.getElementById('prevPage');
        const nextBtn = document.getElementById('nextPage');

        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;
    }

    function setupEventListeners() {
        // Search and filters
        document.getElementById('searchCampaigns').oninput = debounce(filterCampaigns, 300);
        document.getElementById('statusFilter').onchange = filterCampaigns;
        document.getElementById('typeFilter').onchange = filterCampaigns;
        document.getElementById('dateFilter').onchange = filterCampaigns;

        // Pagination
        document.getElementById('prevPage').onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                renderCampaigns();
            }
        };

        document.getElementById('nextPage').onclick = () => {
            const totalPages = Math.ceil(allCampaigns.length / pageSize);
            if (currentPage < totalPages) {
                currentPage++;
                renderCampaigns();
            }
        };

        // Action buttons
        // Note: createCampaign is handled by the global override for the wizard
        document.getElementById('importCampaignsBtn').onclick = () => importCampaigns();
        document.getElementById('exportCampaignsBtn').onclick = () => exportCampaigns();

        // Select all checkbox
        document.getElementById('selectAllCampaigns').onchange = toggleSelectAll;
    }

    function setupBulkActions() {
        document.addEventListener('change', (e) => {
            if (e.target.classList.contains('campaign-checkbox')) {
                updateBulkActionsState();
            }
        });

        // Bulk action buttons
        document.getElementById('bulkDuplicateBtn').onclick = () => bulkDuplicate();
        document.getElementById('bulkScheduleBtn').onclick = () => bulkSchedule();
        document.getElementById('bulkDeleteBtn').onclick = () => bulkDelete();
        document.getElementById('clearSelectionBtn').onclick = () => clearSelection();
    }

    function toggleSelectAll() {
        const selectAll = document.getElementById('selectAllCampaigns');
        const checkboxes = document.querySelectorAll('.campaign-checkbox');

        checkboxes.forEach(checkbox => {
            checkbox.checked = selectAll.checked;
            if (selectAll.checked) {
                selectedCampaigns.add(checkbox.value);
            } else {
                selectedCampaigns.delete(checkbox.value);
            }
        });

        updateBulkActionsState();
    }

    function updateBulkActionsState() {
        const checkboxes = document.querySelectorAll('.campaign-checkbox:checked');
        selectedCampaigns.clear();

        checkboxes.forEach(checkbox => {
            selectedCampaigns.add(checkbox.value);
        });

        const bulkPanel = document.getElementById('bulkActionsPanel');
        const selectedCount = document.getElementById('selectedCount');

        if (selectedCampaigns.size > 0) {
            bulkPanel.classList.remove('hidden');
            selectedCount.textContent = `${selectedCampaigns.size} campaign${selectedCampaigns.size > 1 ? 's' : ''} selected`;
        } else {
            bulkPanel.classList.add('hidden');
        }
    }

    function filterCampaigns() {
        const searchTerm = document.getElementById('searchCampaigns').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const typeFilter = document.getElementById('typeFilter').value;
        const dateFilter = document.getElementById('dateFilter').value;

        // Apply filters (simplified implementation)
        currentPage = 1;
        renderCampaigns();
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function importCampaigns() {
        // Placeholder
    }

    function exportCampaigns() {
        // Placeholder
    }

    function editCampaign(campaignId) {
        // Placeholder
    }

    function viewCampaignAnalytics(campaignId) {
        // Placeholder
    }

    function duplicateCampaign(campaignId) {
        // Placeholder
    }

    function deleteCampaign(campaignId) {
        if (confirm('Are you sure you want to delete this campaign? This action cannot be undone.')) {
            // Placeholder
        }
    }

    function bulkDuplicate() {
        // Placeholder
    }

    function bulkSchedule() {
        // Placeholder
    }

    function bulkDelete() {
        // Placeholder
    }

    function clearSelection() {
        selectedCampaigns.clear();
        const checkboxes = document.querySelectorAll('.campaign-checkbox');
        checkboxes.forEach(cb => cb.checked = false);
        document.getElementById('selectAllCampaigns').checked = false;
        updateBulkActionsState();
    }

    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initNewsletterCampaigns);
    } else if (!window.adminApp) {
        initNewsletterCampaigns();
    }
</script>