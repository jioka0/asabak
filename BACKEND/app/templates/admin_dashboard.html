<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NekwasaR</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/bold/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/duotone/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/fill/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/light/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/thin/style.css">
    <style>
        /* Modern Dashboard Styles - Enhanced Typography */
        .dashboard-wrapper {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--base) 0%, var(--base-tint) 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .dashboard-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--base);
            border-right: 1px solid var(--stroke-elements);
            padding: 2rem 1.5rem;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--stroke-elements);
            position: relative;
        }

        .theme-switcher {
            position: absolute;
            top: 0;
            right: 0;
            background: transparent;
            border: 1px solid var(--stroke-elements);
            border-radius: var(--_radius-m);
            padding: 0.8rem;
            cursor: pointer;
            color: var(--t-bright);
            transition: all 0.3s var(--_animbezier);
            font-size: 1.4rem;
        }

        .theme-switcher:hover {
            background: var(--base-tint);
            transform: scale(1.05);
        }

        .sidebar-logo {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .sidebar-subtitle {
            font-size: 1.1rem;
            color: var(--t-medium);
            font-weight: 500;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.2rem 1.4rem;
            border-radius: var(--_radius-xl);
            cursor: pointer;
            transition: all 0.3s var(--_animbezier);
            color: var(--t-bright);
            text-decoration: none;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: var(--base-tint);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: var(--t-opp-bright);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-icon {
            font-size: 1.6rem;
            width: 24px;
            text-align: center;
        }

        .nav-text {
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: -0.01em;
        }

        .dashboard-main {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 2.5rem;
            background: var(--base);
            border-radius: var(--_radius-xl);
            border: 1px solid var(--stroke-elements);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-title {
            font-size: 2.4rem;
            font-weight: 800;
            color: var(--t-bright);
            margin: 0;
            letter-spacing: -0.02em;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            padding: 0.9rem 1.8rem;
            background: transparent;
            border: 1px solid var(--stroke-controls);
            color: var(--t-bright);
            border-radius: var(--_radius-m);
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s var(--_animbezier);
        }

        .logout-btn:hover {
            background: var(--base-tint);
            transform: translateY(-1px);
        }

        /* Content Sections */
        .content-section {
            background: var(--base);
            border-radius: var(--_radius-xl);
            border: 1px solid var(--stroke-elements);
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--stroke-elements);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--t-bright);
            margin: 0;
            letter-spacing: -0.01em;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--base-tint) 0%, var(--base) 100%);
            border-radius: var(--_radius-xl);
            padding: 2rem;
            text-align: center;
            border: 1px solid var(--stroke-elements);
            transition: all 0.3s var(--_animbezier);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: var(--accent);
            display: block;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .stat-label {
            font-size: 1.2rem;
            color: var(--t-medium);
            font-weight: 600;
            letter-spacing: -0.005em;
        }

        /* Buttons */
        .btn {
            padding: 0.9rem 1.8rem;
            border: none;
            border-radius: var(--_radius-m);
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s var(--_animbezier);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            letter-spacing: -0.005em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            color: var(--t-opp-bright);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: var(--base);
            color: var(--t-bright);
            border: 1px solid var(--stroke-elements);
        }

        .btn-secondary:hover {
            background: var(--base-tint);
        }

        /* Loading and Empty States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--t-medium);
            font-size: 1.3rem;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--t-medium);
        }

        .empty-state__icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s var(--_animbezier);
            }

            .dashboard-sidebar.open {
                transform: translateX(0);
            }

            .dashboard-main {
                margin-left: 0;
            }

            .sidebar-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .dashboard-main {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header-title {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.8rem;
            }

            .stat-number {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body class="dashboard-wrapper">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-header">
            <button class="theme-switcher" id="adminThemeSwitcher" title="Toggle theme">
                <i class="ph-bold ph-moon-stars"></i>
            </button>
            <div class="sidebar-logo">NekwasaR</div>
            <div class="sidebar-subtitle">Admin Panel</div>
        </div>

        <nav class="sidebar-nav">
            <button class="nav-item active" onclick="showSection('overview')">
                <i class="ph-bold ph-house nav-icon"></i>
                <span class="nav-text">Overview</span>
            </button>
            <button class="nav-item" onclick="showSection('analytics')">
                <i class="ph-bold ph-chart-bar nav-icon"></i>
                <span class="nav-text">Analytics</span>
            </button>
            <button class="nav-item" onclick="showSection('contacts')">
                <i class="ph-bold ph-envelope nav-icon"></i>
                <span class="nav-text">Contacts</span>
            </button>
            <button class="nav-item" onclick="showSection('store')">
                <i class="ph-bold ph-storefront nav-icon"></i>
                <span class="nav-text">Store</span>
            </button>
            <button class="nav-item" onclick="showSection('blog')">
                <i class="ph-bold ph-article nav-icon"></i>
                <span class="nav-text">Blog</span>
            </button>
            <button class="nav-item" onclick="showSection('newsletter')">
                <i class="ph-bold ph-paper-plane-tilt nav-icon"></i>
                <span class="nav-text">Newsletter</span>
            </button>
            <button class="nav-item" onclick="showSection('security')">
                <i class="ph-bold ph-shield nav-icon"></i>
                <span class="nav-text">Security</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
        <!-- Header -->
        <header class="dashboard-header">
            <h1 class="header-title" id="pageTitle">Dashboard Overview</h1>
            <div class="header-actions">
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- Overview Section -->
        <section id="overview-section" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-visitors">1,234</span>
                    <span class="stat-label">Total Visitors</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="total-contacts">0</span>
                    <span class="stat-label">Contact Messages</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="total-products">0</span>
                    <span class="stat-label">Products</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="total-posts">0</span>
                    <span class="stat-label">Blog Posts</span>
                </div>
            </div>

            <!-- Dashboard overview content -->
            <div class="text-slate-500">Welcome to your admin dashboard. Use the sidebar to navigate between different sections.</div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Analytics Dashboard</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary">Export Data</button>
                    <button class="btn btn-primary">View Details</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="page-views">5,678</span>
                    <span class="stat-label">Page Views</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="bounce-rate">34%</span>
                    <span class="stat-label">Bounce Rate</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="avg-session">2:34</span>
                    <span class="stat-label">Avg. Session</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="conversion-rate">12%</span>
                    <span class="stat-label">Conversion Rate</span>
                </div>
            </div>
            <div class="text-slate-500">Analytics data will be displayed here...</div>
        </section>

        <!-- Contacts Section -->
        <section id="contacts-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Contact Messages</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary">Export</button>
                    <button class="btn btn-primary">New Message</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="total-messages">0</span>
                    <span class="stat-label">Total Messages</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="unread-messages" style="color: var(--accent);">0</span>
                    <span class="stat-label">Unread</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="read-messages">0</span>
                    <span class="stat-label">Read</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="today-messages">0</span>
                    <span class="stat-label">Today</span>
                </div>
            </div>

            <div id="messagesContainer">
                <div class="text-slate-500">Messages will be displayed here...</div>
            </div>
        </section>

        <!-- Store Section -->
        <section id="store-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Store Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary">Add Product</button>
                </div>
            </div>
            <div class="empty-state">
                <i class="ph-bold ph-storefront empty-state__icon"></i>
                <h3>Store Coming Soon</h3>
                <p>E-commerce functionality will be available here.</p>
            </div>
        </section>

        <!-- Blog Section -->
        <section id="blog-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Blog Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary">New Post</button>
                </div>
            </div>
            <div class="empty-state">
                <i class="ph-bold ph-article empty-state__icon"></i>
                <h3>Blog Coming Soon</h3>
                <p>Content management system will be available here.</p>
            </div>
        </section>

        <!-- Newsletter Section -->
        <section id="newsletter-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Newsletter Management</h2>
                <div class="section-actions">
                    <button class="btn btn-primary">Send Newsletter</button>
                </div>
            </div>
            <div class="empty-state">
                <i class="ph-bold ph-paper-plane-tilt empty-state__icon"></i>
                <h3>Newsletter Coming Soon</h3>
                <p>Subscriber management will be available here.</p>
            </div>
        </section>

        <!-- Security Section -->
        <section id="security-section" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Security Dashboard</h2>
                <div class="section-actions">
                    <button class="btn btn-secondary">View Logs</button>
                </div>
            </div>
            <div class="empty-state">
                <i class="ph-bold ph-shield empty-state__icon"></i>
                <h3>Security Monitoring</h3>
                <p>System security and access logs will be displayed here.</p>
            </div>
        </section>
    </main>

    <script>
        let currentSection = 'overview';
        let allMessages = [];

        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/admin';
                return;
            }

            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    localStorage.removeItem('token');
                    window.location.href = '/admin';
                }
            } catch (error) {
                localStorage.removeItem('token');
                window.location.href = '/admin';
            }
        }

        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));

            // Remove active class from nav items
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));

            // Show selected section
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.add('active');
                currentSection = sectionName;

                // Update page title
                const titles = {
                    'overview': 'Dashboard Overview',
                    'analytics': 'Analytics Dashboard',
                    'contacts': 'Contact Messages',
                    'store': 'Store Management',
                    'blog': 'Blog Management',
                    'newsletter': 'Newsletter Management',
                    'security': 'Security Dashboard'
                };
                document.getElementById('pageTitle').textContent = titles[sectionName] || 'Dashboard';

                // Add active class to clicked nav item
                event.target.closest('.nav-item').classList.add('active');

                // Load data for the section
                if (sectionName === 'contacts') {
                    loadMessages();
                } else if (sectionName === 'analytics') {
                    loadAnalytics();
                } else if (sectionName === 'overview') {
                    loadOverview();
                }
            }
        }

        async function loadOverview() {
            // Load basic stats for overview
            try {
                const response = await fetch('/api/contacts/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });

                if (response.ok) {
                    const messages = await response.json();
                    document.getElementById('total-contacts').textContent = messages.length;
                }
            } catch (error) {
                console.error('Error loading overview:', error);
            }
        }

        async function loadAnalytics() {
            // Mock analytics data - replace with real API calls
            document.getElementById('total-visitors').textContent = '1,234';
            document.getElementById('page-views').textContent = '5,678';
            document.getElementById('bounce-rate').textContent = '34%';
            document.getElementById('avg-session').textContent = '2:34';
            document.getElementById('conversion-rate').textContent = '12%';
        }

        async function loadMessages() {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const response = await fetch('/api/contacts/', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    allMessages = await response.json();
                    renderMessages();
                    updateMessageStats();
                } else if (response.status === 401) {
                    localStorage.removeItem('token');
                    window.location.href = '/admin';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        function renderMessages() {
            const container = document.getElementById('messagesContainer');

            if (allMessages.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="ph-bold ph-envelope empty-state__icon"></i><h3>No messages yet</h3><p>Contact form submissions will appear here.</p></div>';
                return;
            }

            container.innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    ${allMessages.map(msg => `
                        <div style="background: var(--base); border: 1px solid var(--stroke-elements); border-radius: var(--_radius-xl); padding: 1.5rem; transition: all 0.3s var(--_animbezier); cursor: pointer;" onclick="toggleMessage(this)">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div style="font-weight: 700; color: var(--t-bright);">${escapeHtml(msg.name)}</div>
                                <div style="font-size: 1.2rem; color: var(--t-muted);">${new Date(msg.created_at).toLocaleDateString()}</div>
                            </div>
                            <div style="color: var(--t-medium); margin-bottom: 0.5rem;">${escapeHtml(msg.email)}</div>
                            <div style="color: var(--t-medium); line-height: 1.5; margin-bottom: 1rem;">${escapeHtml(msg.message)}</div>
                            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                <button class="btn ${msg.is_read ? 'btn-secondary' : 'btn-primary'}" onclick="markAsRead(${msg.id}, event)">
                                    ${msg.is_read ? 'Mark Unread' : 'Mark Read'}
                                </button>
                                <button class="btn btn-secondary" onclick="deleteMessage(${msg.id}, event)" style="color: #ff6b6b;">Delete</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateMessageStats() {
            const total = allMessages.length;
            const unread = allMessages.filter(msg => !msg.is_read).length;
            const read = total - unread;
            const today = allMessages.filter(msg => {
                const today = new Date();
                const msgDate = new Date(msg.created_at);
                return msgDate.toDateString() === today.toDateString();
            }).length;

            document.getElementById('total-messages').textContent = total;
            document.getElementById('unread-messages').textContent = unread;
            document.getElementById('read-messages').textContent = read;
            document.getElementById('today-messages').textContent = today;
        }

        async function markAsRead(messageId, event) {
            event.stopPropagation();
            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`/api/contacts/${messageId}/read`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    // Update local data
                    const message = allMessages.find(msg => msg.id === messageId);
                    if (message) {
                        message.is_read = !message.is_read;
                        renderMessages();
                        updateMessageStats();
                    }
                }
            } catch (error) {
                console.error('Error updating message:', error);
            }
        }

        async function deleteMessage(messageId, event) {
            event.stopPropagation();
            if (!confirm('Are you sure you want to delete this message?')) return;

            const token = localStorage.getItem('token');

            try {
                const response = await fetch(`/api/contacts/${messageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    // Remove from local data
                    allMessages = allMessages.filter(msg => msg.id !== messageId);
                    renderMessages();
                    updateMessageStats();
                }
            } catch (error) {
                console.error('Error deleting message:', error);
            }
        }

        function toggleMessage(card) {
            card.classList.toggle('expanded');
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/admin';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Theme switcher functionality
        const themeBtn = document.getElementById('adminThemeSwitcher');

        function getCurrentTheme(){
            let theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            localStorage.getItem('admin.theme') ? theme = localStorage.getItem('admin.theme') : null;
            return theme;
        }

        function loadTheme(theme){
            const root = document.querySelector(':root');
            if(theme === "light"){
                if(themeBtn) themeBtn.innerHTML = '<i class="ph-bold ph-moon-stars"></i>';
            } else {
                if(themeBtn) themeBtn.innerHTML = '<i class="ph-bold ph-sun"></i>';
            }
            if(root) root.setAttribute('color-scheme', `${theme}`);
        };

        if(themeBtn) {
            themeBtn.addEventListener('click', () => {
                let theme = getCurrentTheme();
                if(theme === 'dark'){
                    theme = 'light';
                } else {
                    theme = 'dark';
                }
                localStorage.setItem('admin.theme', `${theme}`);
                loadTheme(theme);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadOverview();
            loadTheme(getCurrentTheme());
        });
    </script>
</body>
</html>