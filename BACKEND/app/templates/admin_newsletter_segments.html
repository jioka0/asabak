{% extends "admin_base.html" %}

{% block title %}Newsletter Segments - Admin Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <div class="container mx-auto px-6 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold text-white mb-2">Newsletter Segments</h1>
                    <p class="text-slate-300">Advanced audience segmentation and targeting</p>
                </div>
                <div class="flex gap-4">
                    <button id="createSegmentBtn" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-6 py-3 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                        <i class="fas fa-plus mr-2"></i>Create Segment
                    </button>
                    <button id="importSegmentBtn" class="bg-slate-700 text-white px-6 py-3 rounded-xl hover:bg-slate-600 transition-all duration-200">
                        <i class="fas fa-download mr-2"></i>Import
                    </button>
                </div>
            </div>
        </div>

        <!-- Segment Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-300 text-sm">Total Segments</p>
                        <p class="text-2xl font-bold text-white" id="totalSegments">18</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-users text-blue-400"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-300 text-sm">Active Segments</p>
                        <p class="text-2xl font-bold text-white" id="activeSegments">12</p>
                    </div>
                    <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-check-circle text-green-400"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-300 text-sm">Avg. Segment Size</p>
                        <p class="text-2xl font-bold text-white" id="avgSegmentSize">456</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-pie text-purple-400"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-slate-300 text-sm">Open Rate Boost</p>
                        <p class="text-2xl font-bold text-white" id="openRateBoost">+34%</p>
                    </div>
                    <div class="w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-rocket text-orange-400"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 mb-8">
            <h3 class="text-xl font-bold text-white mb-4">Quick Segment Templates</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button class="bg-white/5 rounded-xl p-4 text-left hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-newspaper text-blue-400"></i>
                        <span class="text-white font-medium">Active Subscribers</span>
                    </div>
                    <p class="text-slate-400 text-sm">Subscribed in last 30 days</p>
                    <p class="text-slate-300 text-sm mt-1">2,456 subscribers</p>
                </button>
                <button class="bg-white/5 rounded-xl p-4 text-left hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-star text-yellow-400"></i>
                        <span class="text-white font-medium">VIP Customers</span>
                    </div>
                    <p class="text-slate-400 text-sm">High engagement & purchases</p>
                    <p class="text-slate-300 text-sm mt-1">324 subscribers</p>
                </button>
                <button class="bg-white/5 rounded-xl p-4 text-left hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-clock text-orange-400"></i>
                        <span class="text-white font-medium">Inactive Users</span>
                    </div>
                    <p class="text-slate-400 text-sm">No activity in 90+ days</p>
                    <p class="text-slate-300 text-sm mt-1">1,123 subscribers</p>
                </button>
                <button class="bg-white/5 rounded-xl p-4 text-left hover:bg-white/10 transition-all duration-200">
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-mobile-alt text-green-400"></i>
                        <span class="text-white font-medium">Mobile Users</span>
                    </div>
                    <p class="text-slate-400 text-sm">Primarily mobile engagement</p>
                    <p class="text-slate-300 text-sm mt-1">1,678 subscribers</p>
                </button>
            </div>
        </div>

        <!-- Segment Builder -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 overflow-hidden mb-8">
            <div class="p-6 border-b border-white/20">
                <h3 class="text-xl font-bold text-white">Segment Builder</h3>
                <p class="text-slate-300 text-sm mt-1">Create dynamic segments based on subscriber behavior and properties</p>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <!-- Criteria Selection -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="space-y-3">
                            <h4 class="text-white font-semibold">Subscriber Properties</h4>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Email domain</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Country/Region</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Signup date</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Tags</span>
                                </label>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <h4 class="text-white font-semibold">Engagement</h4>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Open rate</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Click rate</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Last activity</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Campaign interactions</span>
                                </label>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <h4 class="text-white font-semibold">E-commerce</h4>
                            <div class="space-y-2">
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Purchase history</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Average order value</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Cart abandonment</span>
                                </label>
                                <label class="flex items-center gap-2 text-slate-300 cursor-pointer">
                                    <input type="checkbox" class="rounded bg-white/10 border-white/20">
                                    <span class="text-sm">Product preferences</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preview -->
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h5 class="text-white font-semibold">Segment Preview</h5>
                            <span class="px-3 py-1 bg-blue-500/20 text-blue-400 text-sm rounded-full">1,234 subscribers</span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-slate-300">
                            <span><i class="fas fa-users mr-1"></i>Active subscribers</span>
                            <span><i class="fas fa-calendar mr-1"></i>Joined in last 30 days</span>
                            <span><i class="fas fa-star mr-1"></i>High engagement</span>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 justify-end">
                        <button class="px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-colors">Clear All</button>
                        <button class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all">Save Segment</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Segments -->
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl border border-white/20 overflow-hidden">
            <div class="p-6 border-b border-white/20">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-white">Active Segments</h3>
                    <div class="flex gap-4">
                        <div class="relative">
                            <input type="text" id="segmentSearch" placeholder="Search segments..." class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
                        </div>
                        <select id="segmentTypeFilter" class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">All Types</option>
                            <option value="dynamic">Dynamic</option>
                            <option value="static">Static</option>
                            <option value="behavioral">Behavioral</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-white/5">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Segment Name</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Type</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Subscribers</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Last Updated</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Open Rate</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Click Rate</th>
                            <th class="px-6 py-4 text-left text-sm font-medium text-slate-300">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="segmentTableBody">
                        <!-- Segment data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Segment Editor Modal -->
        <div id="segmentEditorModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-slate-800 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                    <div class="p-6 border-b border-slate-700">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-bold text-white">Segment Editor</h3>
                            <button id="closeEditorBtn" class="text-slate-400 hover:text-white">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                        <div id="segmentEditorContent">
                            <!-- Editor content will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Sample segment data
    let segments = [
        {
            name: "VIP Customers",
            type: "behavioral",
            subscribers: 324,
            lastUpdated: "2 hours ago",
            openRate: "45.2%",
            clickRate: "18.7%"
        },
        {
            name: "New Subscribers (30 days)",
            type: "dynamic",
            subscribers: 456,
            lastUpdated: "1 day ago",
            openRate: "32.1%",
            clickRate: "8.9%"
        },
        {
            name: "High Engagement",
            type: "behavioral",
            subscribers: 892,
            lastUpdated: "3 hours ago",
            openRate: "52.8%",
            clickRate: "24.3%"
        },
        {
            name: "Cart Abandoners",
            type: "dynamic",
            subscribers: 267,
            lastUpdated: "6 hours ago",
            openRate: "28.9%",
            clickRate: "15.6%"
        },
        {
            name: "Inactive Users (90+ days)",
            type: "static",
            subscribers: 1123,
            lastUpdated: "1 week ago",
            openRate: "12.4%",
            clickRate: "2.1%"
        },
        {
            name: "Mobile-First Users",
            type: "behavioral",
            subscribers: 1678,
            lastUpdated: "4 hours ago",
            openRate: "38.7%",
            clickRate: "11.2%"
        },
        {
            name: "Product Enthusiasts",
            type: "dynamic",
            subscribers: 543,
            lastUpdated: "2 days ago",
            openRate: "41.5%",
            clickRate: "19.8%"
        },
        {
            name: "Email Domain: Gmail",
            type: "static",
            subscribers: 2341,
            lastUpdated: "1 hour ago",
            openRate: "29.8%",
            clickRate: "7.3%"
        }
    ];

    let filteredSegments = [...segments];

    // Initialize
    loadSegmentTable();

    // Event listeners
    document.getElementById('segmentSearch').addEventListener('input', filterSegments);
    document.getElementById('segmentTypeFilter').addEventListener('change', filterSegments);
    document.getElementById('createSegmentBtn').addEventListener('click', openSegmentEditor);
    document.getElementById('importSegmentBtn').addEventListener('click', importSegment);
    document.getElementById('closeEditorBtn').addEventListener('click', closeSegmentEditor);

    function loadSegmentTable() {
        const tbody = document.getElementById('segmentTableBody');
        tbody.innerHTML = '';

        filteredSegments.forEach((segment, index) => {
            const row = document.createElement('tr');
            row.className = 'border-b border-white/10 hover:bg-white/5 transition-colors';
            row.innerHTML = `
                <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center">
                            <i class="fas fa-${segment.type === 'dynamic' ? 'sync' : segment.type === 'static' ? 'users' : 'activity'} text-blue-400 text-sm"></i>
                        </div>
                        <div>
                            <p class="text-white font-medium">${segment.name}</p>
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4">
                    <span class="px-3 py-1 text-xs font-medium rounded-full ${
                        segment.type === 'dynamic' ? 'bg-green-500/20 text-green-400' :
                        segment.type === 'static' ? 'bg-blue-500/20 text-blue-400' :
                        'bg-purple-500/20 text-purple-400'
                    }">
                        ${segment.type}
                    </span>
                </td>
                <td class="px-6 py-4">
                    <span class="text-white font-medium">${segment.subscribers.toLocaleString()}</span>
                </td>
                <td class="px-6 py-4 text-slate-300">${segment.lastUpdated}</td>
                <td class="px-6 py-4">
                    <span class="text-white font-medium">${segment.openRate}</span>
                </td>
                <td class="px-6 py-4">
                    <span class="text-white font-medium">${segment.clickRate}</span>
                </td>
                <td class="px-6 py-4">
                    <div class="flex gap-2">
                        <button onclick="editSegment(${index})" class="p-2 text-slate-400 hover:text-white transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="duplicateSegment(${index})" class="p-2 text-slate-400 hover:text-white transition-colors">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button onclick="exportSegment(${index})" class="p-2 text-slate-400 hover:text-white transition-colors">
                            <i class="fas fa-download"></i>
                        </button>
                        <button onclick="deleteSegment(${index})" class="p-2 text-slate-400 hover:text-red-400 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function filterSegments() {
        const searchTerm = document.getElementById('segmentSearch').value.toLowerCase();
        const typeFilter = document.getElementById('segmentTypeFilter').value;

        filteredSegments = segments.filter(segment => {
            const matchesSearch = segment.name.toLowerCase().includes(searchTerm);
            const matchesType = !typeFilter || segment.type === typeFilter;

            return matchesSearch && matchesType;
        });

        loadSegmentTable();
    }

    function openSegmentEditor(segmentIndex = null) {
        const modal = document.getElementById('segmentEditorModal');
        const content = document.getElementById('segmentEditorContent');
        
        if (segmentIndex !== null) {
            const segment = segments[segmentIndex];
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Segment Details</h4>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Segment Name</label>
                                <input type="text" value="${segment.name}" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Segment Type</label>
                                <select class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="dynamic" ${segment.type === 'dynamic' ? 'selected' : ''}>Dynamic (auto-updating)</option>
                                    <option value="static" ${segment.type === 'static' ? 'selected' : ''}>Static (manual list)</option>
                                    <option value="behavioral" ${segment.type === 'behavioral' ? 'selected' : ''}>Behavioral (based on actions)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Description</label>
                                <textarea rows="3" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe this segment...">Segment for ${segment.name.toLowerCase()}</textarea>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Segment Criteria</h4>
                            <div class="bg-white/5 rounded-xl p-4 space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-white">Email Domain</span>
                                    <span class="text-slate-400">Equals gmail.com</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-white">Last Activity</span>
                                    <span class="text-slate-400">Within 30 days</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-white">Open Rate</span>
                                    <span class="text-slate-400">Greater than 25%</span>
                                </div>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-white font-semibold">Estimated Size</span>
                                    <span class="text-blue-400 font-semibold">${segment.subscribers} subscribers</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-4">Advanced Conditions</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white/5 rounded-xl p-4">
                                <h5 class="text-white font-medium mb-3">AND Conditions</h5>
                                <div class="space-y-2">
                                    <div class="flex items-center gap-2">
                                        <select class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option>Has opened</option>
                                            <option>Has clicked</option>
                                            <option>Has purchased</option>
                                        </select>
                                        <select class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option>in last</option>
                                            <option>more than</option>
                                            <option>exactly</option>
                                        </select>
                                        <input type="text" placeholder="30" class="w-16 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                        <span class="text-slate-400 text-sm">days</span>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white/5 rounded-xl p-4">
                                <h5 class="text-white font-medium mb-3">OR Conditions</h5>
                                <div class="space-y-2">
                                    <div class="flex items-center gap-2">
                                        <select class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option>Tags</option>
                                            <option>Location</option>
                                            <option>Device</option>
                                        </select>
                                        <select class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option>contains</option>
                                            <option>equals</option>
                                            <option>not equals</option>
                                        </select>
                                        <input type="text" placeholder="VIP" class="flex-1 bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-4 justify-end">
                        <button onclick="closeSegmentEditor()" class="px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-colors">Cancel</button>
                        <button class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all">Save Segment</button>
                    </div>
                </div>
            `;
        } else {
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Create New Segment</h4>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Segment Name</label>
                                <input type="text" placeholder="Enter segment name" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Segment Type</label>
                                <select class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Type</option>
                                    <option value="dynamic">Dynamic (auto-updating)</option>
                                    <option value="static">Static (manual list)</option>
                                    <option value="behavioral">Behavioral (based on actions)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Description</label>
                                <textarea rows="3" placeholder="Describe this segment..." class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <h4 class="text-lg font-semibold text-white">Quick Templates</h4>
                            <div class="space-y-3">
                                <button class="w-full bg-white/5 rounded-lg p-3 text-left hover:bg-white/10 transition-colors">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-newspaper text-blue-400"></i>
                                        <div>
                                            <p class="text-white font-medium">Active Subscribers</p>
                                            <p class="text-slate-400 text-sm">Subscribed in last 30 days</p>
                                        </div>
                                    </div>
                                </button>
                                <button class="w-full bg-white/5 rounded-lg p-3 text-left hover:bg-white/10 transition-colors">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-star text-yellow-400"></i>
                                        <div>
                                            <p class="text-white font-medium">VIP Customers</p>
                                            <p class="text-slate-400 text-sm">High engagement & purchases</p>
                                        </div>
                                    </div>
                                </button>
                                <button class="w-full bg-white/5 rounded-lg p-3 text-left hover:bg-white/10 transition-colors">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-clock text-orange-400"></i>
                                        <div>
                                            <p class="text-white font-medium">Inactive Users</p>
                                            <p class="text-slate-400 text-sm">No activity in 90+ days</p>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-4 justify-end">
                        <button onclick="closeSegmentEditor()" class="px-6 py-3 bg-white/10 text-white rounded-xl hover:bg-white/20 transition-colors">Cancel</button>
                        <button class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all">Create Segment</button>
                    </div>
                </div>
            `;
        }
        
        modal.classList.remove('hidden');
    }

    function closeSegmentEditor() {
        document.getElementById('segmentEditorModal').classList.add('hidden');
    }

    function importSegment() {
        // Simulate file upload
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.csv,.json';
        input.onchange = function(e) {
            if (e.target.files[0]) {
                showNotification('Segment imported successfully!', 'success');
            }
        };
        input.click();
    }

    // Global functions for segment actions
    window.editSegment = function(index) {
        openSegmentEditor(index);
    };

    window.duplicateSegment = function(index) {
        const segment = segments[index];
        const newSegment = {
            ...segment,
            name: segment.name + ' (Copy)',
            subscribers: Math.floor(segment.subscribers * 0.8), // Reduced for copy
            lastUpdated: 'Just now'
        };
        segments.push(newSegment);
        loadSegmentTable();
        showNotification('Segment duplicated successfully!', 'success');
    };

    window.exportSegment = function(index) {
        const segment = segments[index];
        showNotification(`Segment "${segment.name}" exported successfully!`, 'success');
    };

    window.deleteSegment = function(index) {
        if (confirm('Are you sure you want to delete this segment?')) {
            segments.splice(index, 1);
            loadSegmentTable();
            showNotification('Segment deleted successfully!', 'success');
        }
    };

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-lg ${
            type === 'success' ? 'bg-green-600' : 
            type === 'error' ? 'bg-red-600' : 
            'bg-blue-600'
        } text-white`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
});
</script>
{% endblock %}