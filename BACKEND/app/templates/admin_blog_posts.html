<!-- Tailwind Configuration Script -->
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        'syne': ['Syne', 'sans-serif'],
      },
      colors: {
        'base': 'var(--base)',
        'base-tint': 'var(--base-tint)',
        'base-shade': 'var(--base-shade)',
        'accent': 'var(--accent)',
        'secondary': 'var(--secondary)',
        'secondary-rgba': 'var(--secondary-rgba)',
        'stroke-controls': 'var(--stroke-controls)',
        'stroke-elements': 'var(--stroke-elements)',
        't-bright': 'var(--t-bright)',
        't-medium': 'var(--t-medium)',
        't-muted': 'var(--t-muted)',
        't-accent': 'var(--t-accent)',
        't-secondary': 'var(--t-secondary)',
        't-disabled': 'var(--t-disabled)',
        't-placeholder': 'var(--t-placeholder)',
        'base-opp': 'var(--base-opp)',
        't-opp-bright': 'var(--t-opp-bright)',
        't-opp-medium': 'var(--t-opp-medium)',
        't-opp-muted': 'var(--t-opp-muted)',
        'gradient-one': 'var(--gradient-one)',
        'gradient-two': 'var(--gradient-two)',
        'gradient-three': 'var(--gradient-three)',
      },
      borderRadius: {
        's': 'var(--_radius-s)',
        'm': 'var(--_radius-m)',
        'l': 'var(--_radius-l)',
        'xl': 'var(--_radius-xl)',
      },
      animation: {
        'fade-in': 'fadeIn 0.6s ease-out forwards',
        'slide-up': 'slideUp 0.6s ease-out forwards',
        'scale-in': 'scaleIn 0.4s ease-out forwards',
      },
      transitionTimingFunction: {
        'bezier': 'var(--_animbezier)',
      },
      transitionDuration: {
        'fast': 'var(--_animspeed-fast)',
        'medium': 'var(--_animspeed-medium)',
        'slow': 'var(--_animspeed-slow)',
      },
    },
  },
}
</script>

<div class="min-h-screen bg-gradient-to-br from-gradient-one via-base to-gradient-two dark:from-base dark:via-base-tint dark:to-base-shade transition-all duration-medium overflow-hidden">
    <!-- Windows Explorer Style Layout -->
    <div class="flex flex-col h-screen">
        <!-- Title Bar -->
        <div class="bg-gradient-to-r from-accent via-secondary to-t-accent text-t-opp-bright px-6 py-3 shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="ph-bold ph-article text-xl"></i>
                    <h1 class="text-xl font-bold font-syne">Blog Posts</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="w-8 h-8 bg-t-opp-bright/20 hover:bg-t-opp-bright/30 rounded flex items-center justify-center transition-all duration-medium" onclick="minimizeWindow()">
                        <i class="ph-bold ph-minus text-sm"></i>
                    </button>
                    <button class="w-8 h-8 bg-t-opp-bright/20 hover:bg-t-opp-bright/30 rounded flex items-center justify-center transition-all duration-medium" onclick="maximizeWindow()">
                        <i class="ph-bold ph-square text-sm"></i>
                    </button>
                    <button class="w-8 h-8 bg-red-500/80 hover:bg-red-600/80 rounded flex items-center justify-center transition-all duration-medium" onclick="closeWindow()">
                        <i class="ph-bold ph-x text-sm"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Bar -->
        <div class="bg-base-tint dark:bg-base-shade border-b border-stroke-elements px-6 py-2">
            <div class="flex items-center space-x-6">
                <div class="flex items-center space-x-4">
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="newPost()">New</button>
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="openPost()">Open</button>
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="deleteSelected()">Delete</button>
                </div>
                <div class="h-4 w-px bg-stroke-elements"></div>
                <div class="flex items-center space-x-4">
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="cutItems()">Cut</button>
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="copyItems()">Copy</button>
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="pasteItems()">Paste</button>
                </div>
                <div class="h-4 w-px bg-stroke-elements"></div>
                <div class="flex items-center space-x-4">
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="refreshView()">Refresh</button>
                    <button class="px-3 py-1 text-t-bright hover:bg-accent/20 rounded text-sm font-syne transition-all duration-medium" onclick="showProperties()">Properties</button>
                </div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="bg-base dark:bg-base-tint border-b border-stroke-elements px-6 py-3">
            <div class="flex items-center justify-between">
                <!-- Navigation -->
                <div class="flex items-center space-x-2">
                    <button class="w-8 h-8 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements rounded flex items-center justify-center transition-all duration-medium" onclick="goBack()" title="Back">
                        <i class="ph-bold ph-caret-left"></i>
                    </button>
                    <button class="w-8 h-8 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements rounded flex items-center justify-center transition-all duration-medium" onclick="goForward()" title="Forward">
                        <i class="ph-bold ph-caret-right"></i>
                    </button>
                    <button class="w-8 h-8 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements rounded flex items-center justify-center transition-all duration-medium" onclick="goUp()" title="Up">
                        <i class="ph-bold ph-arrow-up"></i>
                    </button>
                    <div class="h-6 w-px bg-stroke-elements mx-2"></div>
                    <div class="flex items-center space-x-1 text-sm text-t-medium font-syne" id="breadcrumb">
                        <span>Blog Posts</span>
                        <i class="ph-bold ph-caret-right text-xs"></i>
                        <span class="text-t-bright">All Posts</span>
                    </div>
                </div>

                <!-- Search and View Controls -->
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative">
                        <input type="text" class="pl-8 pr-4 py-2 bg-base dark:bg-base-tint border border-stroke-elements rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-all duration-medium text-t-bright text-sm w-64" placeholder="Search posts..." id="searchInput">
                        <i class="ph-bold ph-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-t-muted"></i>
                    </div>

                    <!-- View Mode Toggle -->
                    <div class="flex items-center bg-base-tint dark:bg-base-shade border border-stroke-elements rounded-lg p-1">
                        <button class="w-8 h-8 rounded text-t-medium hover:text-t-bright hover:bg-accent/20 transition-all duration-medium" onclick="setViewMode('large-icons')" title="Large Icons" id="viewLargeIcons">
                            <i class="ph-bold ph-squares-four text-sm"></i>
                        </button>
                        <button class="w-8 h-8 rounded text-t-medium hover:text-t-bright hover:bg-accent/20 transition-all duration-medium" onclick="setViewMode('medium-icons')" title="Medium Icons" id="viewMediumIcons">
                            <i class="ph-bold ph-grid-four text-sm"></i>
                        </button>
                        <button class="w-8 h-8 rounded text-t-bright bg-accent/20 transition-all duration-medium" onclick="setViewMode('list')" title="List" id="viewList">
                            <i class="ph-bold ph-list text-sm"></i>
                        </button>
                        <button class="w-8 h-8 rounded text-t-medium hover:text-t-bright hover:bg-accent/20 transition-all duration-medium" onclick="setViewMode('details')" title="Details" id="viewDetails">
                            <i class="ph-bold ph-table text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Left Sidebar (Folders/Tree) -->
            <div class="w-64 bg-base-tint dark:bg-base-shade border-r border-stroke-elements flex flex-col">
                <!-- Sidebar Header -->
                <div class="p-4 border-b border-stroke-elements">
                    <h3 class="text-sm font-bold text-t-bright font-syne mb-2">Folders</h3>
                </div>

                <!-- Tree View -->
                <div class="flex-1 overflow-y-auto">
                    <div class="tree-view">
                        <!-- All Posts -->
                        <div class="tree-item active" data-folder="all">
                            <div class="tree-item-content">
                                <i class="ph-bold ph-article text-t-accent"></i>
                                <span class="text-sm text-t-bright font-syne">All Posts</span>
                                <span class="text-xs text-t-muted ml-auto" id="allPostsCount">0</span>
                            </div>
                        </div>

                        <!-- Categories -->
                        <div class="tree-item" onclick="toggleTreeItem(this)">
                            <div class="tree-item-content">
                                <i class="ph-bold ph-folder text-t-accent"></i>
                                <span class="text-sm text-t-bright font-syne">Categories</span>
                                <i class="ph-bold ph-caret-right text-xs text-t-muted ml-auto tree-arrow"></i>
                            </div>
                            <div class="tree-children hidden" id="categoriesTree">
                                <!-- Categories will be populated here -->
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="tree-item" onclick="toggleTreeItem(this)">
                            <div class="tree-item-content">
                                <i class="ph-bold ph-tag text-t-accent"></i>
                                <span class="text-sm text-t-bright font-syne">Tags</span>
                                <i class="ph-bold ph-caret-right text-xs text-t-muted ml-auto tree-arrow"></i>
                            </div>
                            <div class="tree-children hidden" id="tagsTree">
                                <!-- Tags will be populated here -->
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="tree-item" onclick="toggleTreeItem(this)">
                            <div class="tree-item-content">
                                <i class="ph-bold ph-check-circle text-t-accent"></i>
                                <span class="text-sm text-t-bright font-syne">Status</span>
                                <i class="ph-bold ph-caret-right text-xs text-t-muted ml-auto tree-arrow"></i>
                            </div>
                            <div class="tree-children hidden" id="statusTree">
                                <div class="tree-item" data-filter="status-published">
                                    <div class="tree-item-content">
                                        <i class="ph-bold ph-check text-green-500"></i>
                                        <span class="text-sm text-t-bright font-syne">Published</span>
                                        <span class="text-xs text-t-muted ml-auto" id="publishedCount">0</span>
                                    </div>
                                </div>
                                <div class="tree-item" data-filter="status-draft">
                                    <div class="tree-item-content">
                                        <i class="ph-bold ph-file-text text-yellow-500"></i>
                                        <span class="text-sm text-t-bright font-syne">Draft</span>
                                        <span class="text-xs text-t-muted ml-auto" id="draftCount">0</span>
                                    </div>
                                </div>
                                <div class="tree-item" data-filter="status-scheduled">
                                    <div class="tree-item-content">
                                        <i class="ph-bold ph-clock text-blue-500"></i>
                                        <span class="text-sm text-t-bright font-syne">Scheduled</span>
                                        <span class="text-xs text-t-muted ml-auto" id="scheduledCount">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Footer -->
                <div class="p-4 border-t border-stroke-elements">
                    <div class="text-xs text-t-muted font-syne">
                        <div class="flex justify-between">
                            <span>Total Posts:</span>
                            <span id="totalPostsCount">0</span>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span>Selected:</span>
                            <span id="selectedCount">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="flex-1 flex flex-col">
                <!-- Status Bar -->
                <div class="bg-base-tint dark:bg-base-shade border-b border-stroke-elements px-4 py-2">
                    <div class="flex items-center justify-between text-sm text-t-medium font-syne">
                        <div class="flex items-center space-x-4">
                            <span id="itemsCount">0 items</span>
                            <span id="selectedItemsInfo">0 selected</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span id="sortInfo">Sorted by Name</span>
                            <span id="viewInfo">List view</span>
                        </div>
                    </div>
                </div>

                <!-- Content View -->
                <div class="flex-1 overflow-hidden">
                    <!-- List View -->
                    <div class="view-mode list-view h-full overflow-y-auto" id="listView">
                        <div class="p-4">
                            <!-- Column Headers -->
                            <div class="grid grid-cols-12 gap-4 px-4 py-2 bg-base-tint/50 dark:bg-base-shade/50 border-b border-stroke-elements text-sm font-bold text-t-bright font-syne mb-2">
                                <div class="col-span-1"></div>
                                <div class="col-span-6">Name</div>
                                <div class="col-span-2">Status</div>
                                <div class="col-span-2">Modified</div>
                                <div class="col-span-1">Size</div>
                            </div>

                            <!-- Posts List -->
                            <div id="postsList" class="space-y-1">
                                <!-- Posts will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Large Icons View -->
                    <div class="view-mode large-icons-view h-full overflow-y-auto hidden" id="largeIconsView">
                        <div class="p-6">
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6" id="largeIconsGrid">
                                <!-- Large icons will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Medium Icons View -->
                    <div class="view-mode medium-icons-view h-full overflow-y-auto hidden" id="mediumIconsView">
                        <div class="p-6">
                            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4" id="mediumIconsGrid">
                                <!-- Medium icons will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Details View -->
                    <div class="view-mode details-view h-full overflow-y-auto hidden" id="detailsView">
                        <div class="p-4">
                            <!-- Column Headers -->
                            <div class="grid grid-cols-12 gap-4 px-4 py-2 bg-base-tint/50 dark:bg-base-shade/50 border-b border-stroke-elements text-sm font-bold text-t-bright font-syne mb-2 cursor-pointer">
                                <div class="col-span-1"></div>
                                <div class="col-span-3">Name</div>
                                <div class="col-span-2">Status</div>
                                <div class="col-span-2">Category</div>
                                <div class="col-span-2">Author</div>
                                <div class="col-span-1">Views</div>
                                <div class="col-span-1">Modified</div>
                            </div>

                            <!-- Posts Details -->
                            <div id="postsDetails" class="space-y-1">
                                <!-- Posts will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Context Menu -->
<div class="context-menu fixed z-50 bg-base dark:bg-base-tint border border-stroke-elements rounded-lg shadow-xl py-2 hidden" id="contextMenu">
    <div class="px-4 py-2 text-xs font-bold text-t-bright font-syne border-b border-stroke-elements">Post Options</div>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="openPost()">
        <i class="ph-bold ph-pencil text-accent"></i>
        <span>Open</span>
    </button>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="editPost()">
        <i class="ph-bold ph-note-pencil text-accent"></i>
        <span>Edit</span>
    </button>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="duplicatePost()">
        <i class="ph-bold ph-copy text-accent"></i>
        <span>Duplicate</span>
    </button>
    <div class="border-t border-stroke-elements my-1"></div>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="cutItems()">
        <i class="ph-bold ph-scissors text-accent"></i>
        <span>Cut</span>
    </button>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="copyItems()">
        <i class="ph-bold ph-copy text-accent"></i>
        <span>Copy</span>
    </button>
    <div class="border-t border-stroke-elements my-1"></div>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="deleteSelected()">
        <i class="ph-bold ph-trash text-red-500"></i>
        <span>Delete</span>
    </button>
    <button class="w-full px-4 py-2 text-left text-sm text-t-bright hover:bg-accent/20 transition-all duration-medium font-syne flex items-center space-x-3" onclick="showProperties()">
        <i class="ph-bold ph-info text-accent"></i>
        <span>Properties</span>
    </button>
</div>

<!-- Custom CSS for Windows Explorer styling -->
<style>
/* Tree View Styles */
.tree-view {
  @apply space-y-1;
}

.tree-item {
  @apply cursor-pointer;
}

.tree-item.active {
  @apply bg-accent/20;
}

.tree-item:hover {
  @apply bg-base-shade/50 dark:bg-base-tint/50;
}

.tree-item-content {
  @apply flex items-center space-x-3 px-4 py-2 text-sm;
}

.tree-arrow {
  @apply transition-transform duration-medium;
}

.tree-item.expanded .tree-arrow {
  @apply rotate-90;
}

.tree-children {
  @apply ml-6 space-y-1;
}

.tree-children .tree-item-content {
  @apply px-3 py-1;
}

/* View Modes */
.view-mode {
  @apply w-full;
}

/* List View Item */
.list-item {
  @apply grid grid-cols-12 gap-4 px-4 py-3 hover:bg-base-tint/30 dark:hover:bg-base-shade/30 rounded-lg cursor-pointer transition-all duration-medium border border-transparent hover:border-stroke-elements;
}

.list-item.selected {
  @apply bg-accent/20 border-accent/50;
}

.list-item-checkbox {
  @apply w-4 h-4 text-accent bg-base dark:bg-base-tint border-2 border-stroke-elements rounded focus:ring-2 focus:ring-accent focus:ring-offset-0 cursor-pointer;
}

.list-item-icon {
  @apply w-6 h-6 text-accent flex-shrink-0;
}

.list-item-name {
  @apply text-sm text-t-bright font-syne truncate;
}

.list-item-status {
  @apply text-xs font-semibold uppercase tracking-wide font-syne;
}

.status-published {
  @apply text-green-500;
}

.status-draft {
  @apply text-yellow-500;
}

.status-scheduled {
  @apply text-blue-500;
}

/* Large Icons View */
.large-icon-item {
  @apply flex flex-col items-center space-y-3 p-4 hover:bg-base-tint/30 dark:hover:bg-base-shade/30 rounded-lg cursor-pointer transition-all duration-medium border border-transparent hover:border-stroke-elements;
}

.large-icon-item.selected {
  @apply bg-accent/20 border-accent/50;
}

.large-icon-image {
  @apply w-16 h-16 bg-gradient-to-br from-accent/20 to-secondary/20 rounded-lg flex items-center justify-center text-2xl text-accent;
}

.large-icon-name {
  @apply text-sm text-t-bright font-syne text-center truncate w-full;
}

/* Medium Icons View */
.medium-icon-item {
  @apply flex flex-col items-center space-y-2 p-3 hover:bg-base-tint/30 dark:hover:bg-base-shade/30 rounded-lg cursor-pointer transition-all duration-medium border border-transparent hover:border-stroke-elements;
}

.medium-icon-item.selected {
  @apply bg-accent/20 border-accent/50;
}

.medium-icon-image {
  @apply w-12 h-12 bg-gradient-to-br from-accent/20 to-secondary/20 rounded-lg flex items-center justify-center text-xl text-accent;
}

.medium-icon-name {
  @apply text-xs text-t-bright font-syne text-center truncate w-full;
}

/* Details View */
.details-item {
  @apply grid grid-cols-12 gap-4 px-4 py-3 hover:bg-base-tint/30 dark:hover:bg-base-shade/30 rounded-lg cursor-pointer transition-all duration-medium border border-transparent hover:border-stroke-elements;
}

.details-item.selected {
  @apply bg-accent/20 border-accent/50;
}

.details-item-checkbox {
  @apply w-4 h-4 text-accent bg-base dark:bg-base-tint border-2 border-stroke-elements rounded focus:ring-2 focus:ring-accent focus:ring-offset-0 cursor-pointer;
}

.details-item-icon {
  @apply w-5 h-5 text-accent flex-shrink-0;
}

.details-item-name {
  @apply text-sm text-t-bright font-syne truncate;
}

.details-item-category {
  @apply text-xs text-t-medium font-syne truncate;
}

.details-item-author {
  @apply text-xs text-t-medium font-syne truncate;
}

/* Context Menu */
.context-menu {
  @apply min-w-48;
}

/* Selection and Drag States */
.item-selected {
  @apply bg-accent/20 border-accent/50;
}

.item-dragging {
  @apply opacity-50 transform rotate-2;
}

/* Scrollbar Styling */
.overflow-y-auto::-webkit-scrollbar,
.overflow-x-auto::-webkit-scrollbar {
  width: 12px;
}

.overflow-y-auto::-webkit-scrollbar-track,
.overflow-x-auto::-webkit-scrollbar-track {
  background: var(--base-tint);
  border-radius: 6px;
}

.overflow-y-auto::-webkit-scrollbar-thumb,
.overflow-x-auto::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 6px;
}

.overflow-y-auto::-webkit-scrollbar-thumb:hover,
.overflow-x-auto::-webkit-scrollbar-thumb:hover {
  background: var(--secondary);
}

/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeInUp 0.3s ease-out forwards;
}
</style>

<script>
// Blog Posts Explorer - Windows File Explorer Style
let currentViewMode = 'list';
let selectedItems = new Set();
let allPosts = [];
let currentFolder = 'all';
let searchTerm = '';

function initBlogPosts() {
    loadPostsData();
    setupEventListeners();
    setupContextMenu();
    setupKeyboardShortcuts();
}

async function loadPostsData() {
    try {
        const response = await fetch('/api/admin/blog/posts');
        if (response.ok) {
            const data = await response.json();
            allPosts = data.posts || [];
            updateSidebarCounts(data.stats);
            renderCurrentView();
        } else {
            showFallbackPostsData();
        }
    } catch (error) {
        console.error('Error loading posts data:', error);
        showFallbackPostsData();
    }
}

function updateSidebarCounts(stats) {
    document.getElementById('allPostsCount').textContent = stats.totalPosts || 0;
    document.getElementById('publishedCount').textContent = stats.publishedCount || 0;
    document.getElementById('draftCount').textContent = stats.draftCount || 0;
    document.getElementById('scheduledCount').textContent = stats.scheduledCount || 0;
    document.getElementById('totalPostsCount').textContent = stats.totalPosts || 0;

    // Update categories and tags trees
    renderCategoriesTree(stats.categories || []);
    renderTagsTree(stats.tags || []);
}

function renderCategoriesTree(categories) {
    const container = document.getElementById('categoriesTree');
    container.innerHTML = categories.map(category => `
        <div class="tree-item" data-filter="category-${category.id}">
            <div class="tree-item-content">
                <i class="ph-bold ph-folder text-blue-500"></i>
                <span class="text-sm text-t-bright font-syne">${category.name}</span>
                <span class="text-xs text-t-muted ml-auto">${category.count}</span>
            </div>
        </div>
    `).join('');
}

function renderTagsTree(tags) {
    const container = document.getElementById('tagsTree');
    container.innerHTML = tags.map(tag => `
        <div class="tree-item" data-filter="tag-${tag.id}">
            <div class="tree-item-content">
                <i class="ph-bold ph-tag text-purple-500"></i>
                <span class="text-sm text-t-bright font-syne">${tag.name}</span>
                <span class="text-xs text-t-muted ml-auto">${tag.count}</span>
            </div>
        </div>
    `).join('');
}

function renderCurrentView() {
    const filteredPosts = filterPosts();
    updateStatusBar(filteredPosts.length);

    switch (currentViewMode) {
        case 'list':
            renderListView(filteredPosts);
            break;
        case 'large-icons':
            renderLargeIconsView(filteredPosts);
            break;
        case 'medium-icons':
            renderMediumIconsView(filteredPosts);
            break;
        case 'details':
            renderDetailsView(filteredPosts);
            break;
    }
}

function filterPosts() {
    let filtered = allPosts;

    // Apply folder filter
    if (currentFolder !== 'all') {
        if (currentFolder.startsWith('category-')) {
            const categoryId = currentFolder.replace('category-', '');
            filtered = filtered.filter(post => post.categoryId === categoryId);
        } else if (currentFolder.startsWith('tag-')) {
            const tagId = currentFolder.replace('tag-', '');
            filtered = filtered.filter(post => post.tags && post.tags.includes(tagId));
        } else if (currentFolder.startsWith('status-')) {
            const status = currentFolder.replace('status-', '');
            filtered = filtered.filter(post => post.status === status);
        }
    }

    // Apply search filter
    if (searchTerm) {
        filtered = filtered.filter(post =>
            post.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
            post.excerpt.toLowerCase().includes(searchTerm.toLowerCase()) ||
            post.author.toLowerCase().includes(searchTerm.toLowerCase())
        );
    }

    return filtered;
}

function renderListView(posts) {
    const container = document.getElementById('postsList');
    container.innerHTML = posts.map(post => `
        <div class="list-item ${selectedItems.has(post.id) ? 'selected' : ''}" data-post-id="${post.id}" onclick="selectItem('${post.id}', event)" ondblclick="openPost('${post.id}')" oncontextmenu="showContextMenu(event, '${post.id}')">
            <div class="col-span-1 flex items-center">
                <input type="checkbox" class="list-item-checkbox" ${selectedItems.has(post.id) ? 'checked' : ''} onchange="toggleSelection('${post.id}')">
            </div>
            <div class="col-span-6 flex items-center space-x-3">
                <i class="ph-bold ph-article list-item-icon"></i>
                <div class="min-w-0 flex-1">
                    <div class="list-item-name">${post.title}</div>
                    <div class="text-xs text-t-muted font-syne truncate">${post.excerpt || 'No excerpt'}</div>
                </div>
            </div>
            <div class="col-span-2 flex items-center">
                <span class="list-item-status status-${post.status}">${formatStatus(post.status)}</span>
            </div>
            <div class="col-span-2 flex items-center text-xs text-t-medium font-syne">
                ${formatDate(post.updatedAt)}
            </div>
            <div class="col-span-1 flex items-center text-xs text-t-medium font-syne">
                ${formatFileSize(post.contentLength || 0)}
            </div>
        </div>
    `).join('');
}

function renderLargeIconsView(posts) {
    const container = document.getElementById('largeIconsGrid');
    container.innerHTML = posts.map(post => `
        <div class="large-icon-item ${selectedItems.has(post.id) ? 'selected' : ''}" data-post-id="${post.id}" onclick="selectItem('${post.id}', event)" ondblclick="openPost('${post.id}')" oncontextmenu="showContextMenu(event, '${post.id}')">
            <div class="large-icon-image">
                <i class="ph-bold ph-article"></i>
            </div>
            <div class="large-icon-name">${post.title}</div>
            <div class="text-xs text-t-muted font-syne text-center">${formatStatus(post.status)}</div>
        </div>
    `).join('');
}

function renderMediumIconsView(posts) {
    const container = document.getElementById('mediumIconsGrid');
    container.innerHTML = posts.map(post => `
        <div class="medium-icon-item ${selectedItems.has(post.id) ? 'selected' : ''}" data-post-id="${post.id}" onclick="selectItem('${post.id}', event)" ondblclick="openPost('${post.id}')" oncontextmenu="showContextMenu(event, '${post.id}')">
            <div class="medium-icon-image">
                <i class="ph-bold ph-article"></i>
            </div>
            <div class="medium-icon-name">${post.title}</div>
        </div>
    `).join('');
}

function renderDetailsView(posts) {
    const container = document.getElementById('postsDetails');
    container.innerHTML = posts.map(post => `
        <div class="details-item ${selectedItems.has(post.id) ? 'selected' : ''}" data-post-id="${post.id}" onclick="selectItem('${post.id}', event)" ondblclick="openPost('${post.id}')" oncontextmenu="showContextMenu(event, '${post.id}')">
            <div class="col-span-1 flex items-center">
                <input type="checkbox" class="details-item-checkbox" ${selectedItems.has(post.id) ? 'checked' : ''} onchange="toggleSelection('${post.id}')">
            </div>
            <div class="col-span-3 flex items-center space-x-3">
                <i class="ph-bold ph-article details-item-icon"></i>
                <div class="min-w-0 flex-1">
                    <div class="details-item-name">${post.title}</div>
                </div>
            </div>
            <div class="col-span-2 flex items-center">
                <span class="list-item-status status-${post.status}">${formatStatus(post.status)}</span>
            </div>
            <div class="col-span-2 flex items-center">
                <span class="details-item-category">${post.category || 'Uncategorized'}</span>
            </div>
            <div class="col-span-2 flex items-center">
                <span class="details-item-author">${post.author || 'Unknown'}</span>
            </div>
            <div class="col-span-1 flex items-center text-xs text-t-medium font-syne">
                ${post.views || 0}
            </div>
            <div class="col-span-1 flex items-center text-xs text-t-medium font-syne">
                ${formatDate(post.updatedAt)}
            </div>
        </div>
    `).join('');
}

function setViewMode(mode) {
    // Update view mode buttons
    document.querySelectorAll('[id^="view"]').forEach(btn => {
        btn.classList.remove('text-t-bright', 'bg-accent/20');
        btn.classList.add('text-t-medium');
    });

    const activeBtn = document.getElementById(`view${mode.charAt(0).toUpperCase() + mode.slice(1).replace('-', '')}`);
    activeBtn.classList.remove('text-t-medium');
    activeBtn.classList.add('text-t-bright', 'bg-accent/20');

    // Hide all views
    document.querySelectorAll('.view-mode').forEach(view => view.classList.add('hidden'));

    // Show selected view
    document.getElementById(`${mode}View`).classList.remove('hidden');

    currentViewMode = mode;
    updateStatusBarText();
    renderCurrentView();
}

function selectItem(postId, event) {
    if (event.ctrlKey || event.metaKey) {
        // Multi-select
        if (selectedItems.has(postId)) {
            selectedItems.delete(postId);
        } else {
            selectedItems.add(postId);
        }
    } else if (event.shiftKey) {
        // Range select (simplified)
        selectedItems.clear();
        selectedItems.add(postId);
    } else {
        // Single select
        selectedItems.clear();
        selectedItems.add(postId);
    }

    updateSelectionUI();
}

function toggleSelection(postId) {
    if (selectedItems.has(postId)) {
        selectedItems.delete(postId);
    } else {
        selectedItems.add(postId);
    }
    updateSelectionUI();
}

function updateSelectionUI() {
    // Update checkboxes
    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        const postId = checkbox.closest('[data-post-id]').dataset.postId;
        checkbox.checked = selectedItems.has(postId);
    });

    // Update visual selection
    document.querySelectorAll('[data-post-id]').forEach(item => {
        const postId = item.dataset.postId;
        if (selectedItems.has(postId)) {
            item.classList.add('selected');
        } else {
            item.classList.remove('selected');
        }
    });

    updateStatusBar(selectedItems.size);
}

function updateStatusBar(itemCount) {
    document.getElementById('itemsCount').textContent = `${itemCount} item${itemCount !== 1 ? 's' : ''}`;
    document.getElementById('selectedCount').textContent = selectedItems.size;
    document.getElementById('selectedItemsInfo').textContent = `${selectedItems.size} selected`;
}

function updateStatusBarText() {
    const viewNames = {
        'list': 'List view',
        'large-icons': 'Large icons view',
        'medium-icons': 'Medium icons view',
        'details': 'Details view'
    };
    document.getElementById('viewInfo').textContent = viewNames[currentViewMode] || 'List view';
}

function toggleTreeItem(element) {
    const children = element.querySelector('.tree-children');
    const arrow = element.querySelector('.tree-arrow');

    if (children.classList.contains('hidden')) {
        children.classList.remove('hidden');
        element.classList.add('expanded');
        arrow.classList.add('rotate-90');
    } else {
        children.classList.add('hidden');
        element.classList.remove('expanded');
        arrow.classList.remove('rotate-90');
    }
}

function setupEventListeners() {
    // Search
    document.getElementById('searchInput').oninput = debounce((e) => {
        searchTerm = e.target.value;
        renderCurrentView();
    }, 300);

    // Tree navigation
    document.addEventListener('click', (e) => {
        const treeItem = e.target.closest('.tree-item[data-filter]');
        if (treeItem) {
            const filter = treeItem.dataset.filter;
            navigateToFolder(filter);
        }
    });
}

function navigateToFolder(folder) {
    currentFolder = folder;

    // Update active tree item
    document.querySelectorAll('.tree-item').forEach(item => item.classList.remove('active'));
    document.querySelector(`[data-filter="${folder}"]`)?.classList.add('active');

    // Update breadcrumb
    updateBreadcrumb(folder);

    renderCurrentView();
}

function updateBreadcrumb(folder) {
    const breadcrumb = document.getElementById('breadcrumb');
    let path = 'Blog Posts';

    if (folder.startsWith('category-')) {
        path = `Blog Posts > Categories > ${folder.replace('category-', '')}`;
    } else if (folder.startsWith('tag-')) {
        path = `Blog Posts > Tags > ${folder.replace('tag-', '')}`;
    } else if (folder.startsWith('status-')) {
        path = `Blog Posts > Status > ${folder.replace('status-', '').charAt(0).toUpperCase() + folder.replace('status-', '').slice(1)}`;
    } else {
        path = 'Blog Posts > All Posts';
    }

    breadcrumb.innerHTML = path.split(' > ').map((part, index) => {
        if (index === path.split(' > ').length - 1) {
            return `<span class="text-t-bright">${part}</span>`;
        }
        return `<span>${part}</span><i class="ph-bold ph-caret-right text-xs mx-1"></i>`;
    }).join('');
}

function setupContextMenu() {
    document.addEventListener('contextmenu', (e) => {
        const item = e.target.closest('[data-post-id]');
        if (item) {
            e.preventDefault();
            const postId = item.dataset.postId;
            showContextMenu(e, postId);
        }
    });

    // Hide context menu on click outside
    document.addEventListener('click', () => {
        document.getElementById('contextMenu').classList.add('hidden');
    });
}

function showContextMenu(event, postId) {
    event.preventDefault();
    const menu = document.getElementById('contextMenu');

    // Select the item if not already selected
    if (!selectedItems.has(postId)) {
        selectedItems.clear();
        selectedItems.add(postId);
        updateSelectionUI();
    }

    menu.style.left = `${event.pageX}px`;
    menu.style.top = `${event.pageY}px`;
    menu.classList.remove('hidden');
}

function setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
        // Ctrl+A to select all
        if (e.ctrlKey && e.key === 'a') {
            e.preventDefault();
            selectAll();
        }

        // Delete key to delete selected
        if (e.key === 'Delete') {
            deleteSelected();
        }

        // F2 to rename/edit
        if (e.key === 'F2') {
            e.preventDefault();
            if (selectedItems.size === 1) {
                editPost();
            }
        }

        // Ctrl+C to copy
        if (e.ctrlKey && e.key === 'c') {
            copyItems();
        }

        // Ctrl+X to cut
        if (e.ctrlKey && e.key === 'x') {
            cutItems();
        }

        // Ctrl+V to paste
        if (e.ctrlKey && e.key === 'v') {
            pasteItems();
        }
    });
}

function selectAll() {
    const visibleItems = document.querySelectorAll('[data-post-id]');
    selectedItems.clear();
    visibleItems.forEach(item => {
        selectedItems.add(item.dataset.postId);
    });
    updateSelectionUI();
}

function formatStatus(status) {
    return status.charAt(0).toUpperCase() + status.slice(1);
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));

    if (days === 0) return 'Today';
    if (days === 1) return 'Yesterday';
    if (days < 7) return `${days} days ago`;
    if (days < 30) return `${Math.floor(days / 7)} weeks ago`;

    return date.toLocaleDateString();
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function showFallbackPostsData() {
    // Show sample data when API is not available
    updateSidebarCounts({
        totalPosts: 24,
        publishedCount: 18,
        draftCount: 4,
        scheduledCount: 2
    });

    // Sample posts
    allPosts = [
        {
            id: '1',
            title: 'Getting Started with React',
            excerpt: 'Learn the basics of React development',
            status: 'published',
            author: 'NekwasaR',
            category: 'Technology',
            updatedAt: '2024-01-15T10:30:00Z',
            contentLength: 2456,
            views: 1250
        },
        {
            id: '2',
            title: 'Advanced CSS Techniques',
            excerpt: 'Master modern CSS with these advanced techniques',
            status: 'draft',
            author: 'NekwasaR',
            category: 'Design',
            updatedAt: '2024-01-14T09:15:00Z',
            contentLength: 1890,
            views: 0
        }
    ];

    renderCurrentView();
}

// Action functions
function newPost() { showNotification('New post modal would open here', 'info'); }
function openPost(postId) { showNotification(`Opening post ${postId}`, 'info'); }
function editPost() { showNotification('Edit post modal would open here', 'info'); }
function duplicatePost() { showNotification('Duplicate post functionality', 'info'); }
function deleteSelected() { showNotification(`Deleting ${selectedItems.size} posts`, 'info'); }
function cutItems() { showNotification('Cut functionality', 'info'); }
function copyItems() { showNotification('Copy functionality', 'info'); }
function pasteItems() { showNotification('Paste functionality', 'info'); }
function refreshView() { loadPostsData(); showNotification('View refreshed', 'success'); }
function showProperties() { showNotification('Properties modal would open here', 'info'); }
function goBack() { showNotification('Go back functionality', 'info'); }
function goForward() { showNotification('Go forward functionality', 'info'); }
function goUp() { navigateToFolder('all'); }

// Window controls (mock)
function minimizeWindow() { showNotification('Window minimized', 'info'); }
function maximizeWindow() { showNotification('Window maximized', 'info'); }
function closeWindow() { showNotification('Window closed', 'info'); }

function showNotification(message, type = 'info') {
    // TODO: Implement notification system
    console.log(`${type.toUpperCase()}: ${message}`);
}

// Initialize when page loads
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBlogPosts);
} else {
    initBlogPosts();
}
</script>
</