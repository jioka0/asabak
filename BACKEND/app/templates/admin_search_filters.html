<!-- Search Filters Configuration -->
<div class="search-filters">
    <div class="analytics-header">
        <h1 class="page-title">Search Filters Configuration</h1>
        <p class="page-subtitle">Configure available search filters and their behavior</p>
    </div>

    <!-- Filters Overview -->
    <div class="filters-overview">
        <div class="overview-card">
            <div class="card-icon">
                <i class="ph-bold ph-funnel"></i>
            </div>
            <div class="card-content">
                <div class="card-value" id="activeFilters">0</div>
                <div class="card-label">Active Filters</div>
                <div class="card-trend" id="filtersTrend">
                    <i class="ph-bold ph-trend-up"></i>
                    <span>+5.2%</span>
                </div>
            </div>
        </div>

        <div class="overview-card">
            <div class="card-icon">
                <i class="ph-bold ph-check-circle"></i>
            </div>
            <div class="card-content">
                <div class="card-value" id="filterUsage">0%</div>
                <div class="card-label">Filter Usage Rate</div>
                <div class="card-trend" id="usageTrend">
                    <i class="ph-bold ph-trend-up"></i>
                    <span>+8.7%</span>
                </div>
            </div>
        </div>

        <div class="overview-card">
            <div class="card-icon">
                <i class="ph-bold ph-target"></i>
            </div>
            <div class="card-content">
                <div class="card-value" id="filterPrecision">0%</div>
                <div class="card-label">Filter Precision</div>
                <div class="card-trend" id="precisionTrend">
                    <i class="ph-bold ph-trend-up"></i>
                    <span>+3.1%</span>
                </div>
            </div>
        </div>

        <div class="overview-card">
            <div class="card-icon">
                <i class="ph-bold ph-clock"></i>
            </div>
            <div class="card-content">
                <div class="card-value" id="avgFilterTime">0ms</div>
                <div class="card-label">Avg. Filter Time</div>
                <div class="card-trend" id="filterTimeTrend">
                    <i class="ph-bold ph-trend-down"></i>
                    <span>-2.4%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Management Tabs -->
    <div class="filters-tabs">
        <div class="tabs-header">
            <button class="tab-btn active" data-tab="sections">Sections</button>
            <button class="tab-btn" data-tab="tags">Tags</button>
            <button class="tab-btn" data-tab="dates">Date Ranges</button>
            <button class="tab-btn" data-tab="authors">Authors</button>
            <button class="tab-btn" data-tab="custom">Custom Filters</button>
        </div>

        <div class="tabs-content">
            <!-- Sections Tab -->
            <div class="tab-content active" id="sections-tab">
                <div class="tab-header">
                    <h3>Section Filters</h3>
                    <div class="tab-actions">
                        <button class="action-btn" id="refreshSectionsBtn">
                            <i class="ph-bold ph-refresh"></i>
                            Refresh
                        </button>
                        <button class="action-btn primary" id="addSectionBtn">
                            <i class="ph-bold ph-plus"></i>
                            Add Section
                        </button>
                    </div>
                </div>
                <div class="filters-grid" id="sectionsGrid">
                    <!-- Section filters will be populated here -->
                </div>
            </div>

            <!-- Tags Tab -->
            <div class="tab-content" id="tags-tab">
                <div class="tab-header">
                    <h3>Tag Filters</h3>
                    <div class="tab-actions">
                        <button class="action-btn" id="autoGenerateTagsBtn">
                            <i class="ph-bold ph-magic-wand"></i>
                            Auto Generate
                        </button>
                        <button class="action-btn primary" id="addTagBtn">
                            <i class="ph-bold ph-plus"></i>
                            Add Tag
                        </button>
                    </div>
                </div>
                <div class="filters-list" id="tagsList">
                    <!-- Tag filters will be populated here -->
                </div>
            </div>

            <!-- Date Ranges Tab -->
            <div class="tab-content" id="dates-tab">
                <div class="tab-header">
                    <h3>Date Range Filters</h3>
                    <div class="tab-actions">
                        <button class="action-btn primary" id="addDateRangeBtn">
                            <i class="ph-bold ph-plus"></i>
                            Add Range
                        </button>
                    </div>
                </div>
                <div class="date-ranges-list" id="dateRangesList">
                    <!-- Date range filters will be populated here -->
                </div>
            </div>

            <!-- Authors Tab -->
            <div class="tab-content" id="authors-tab">
                <div class="tab-header">
                    <h3>Author Filters</h3>
                    <div class="tab-actions">
                        <button class="action-btn" id="syncAuthorsBtn">
                            <i class="ph-bold ph-refresh"></i>
                            Sync Authors
                        </button>
                    </div>
                </div>
                <div class="authors-list" id="authorsList">
                    <!-- Author filters will be populated here -->
                </div>
            </div>

            <!-- Custom Filters Tab -->
            <div class="tab-content" id="custom-tab">
                <div class="tab-header">
                    <h3>Custom Filters</h3>
                    <div class="tab-actions">
                        <button class="action-btn primary" id="createCustomFilterBtn">
                            <i class="ph-bold ph-plus"></i>
                            Create Filter
                        </button>
                    </div>
                </div>
                <div class="custom-filters-list" id="customFiltersList">
                    <!-- Custom filters will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Analytics -->
    <div class="filter-analytics">
        <div class="section-header">
            <h3>Filter Usage Analytics</h3>
            <div class="analytics-controls">
                <select id="analyticsPeriod">
                    <option value="7d">Last 7 days</option>
                    <option value="30d">Last 30 days</option>
                    <option value="90d">Last 90 days</option>
                </select>
            </div>
        </div>
        <div class="analytics-content">
            <div class="analytics-chart">
                <canvas id="filterUsageChart"></canvas>
            </div>
            <div class="analytics-breakdown" id="filterBreakdown">
                <!-- Filter usage breakdown will be populated here -->
            </div>
        </div>
    </div>

    <!-- Filter Testing -->
    <div class="filter-testing">
        <div class="section-header">
            <h3>Test Filter Combinations</h3>
        </div>
        <div class="testing-interface">
            <div class="test-filters">
                <div class="test-filter-group">
                    <label>Section</label>
                    <select id="testSection">
                        <option value="">All Sections</option>
                    </select>
                </div>
                <div class="test-filter-group">
                    <label>Tags</label>
                    <select id="testTags" multiple>
                        <!-- Tags will be populated -->
                    </select>
                </div>
                <div class="test-filter-group">
                    <label>Date Range</label>
                    <select id="testDateRange">
                        <option value="">Any Time</option>
                    </select>
                </div>
                <div class="test-filter-group">
                    <label>Author</label>
                    <select id="testAuthor">
                        <option value="">Any Author</option>
                    </select>
                </div>
            </div>
            <div class="test-actions">
                <button class="action-btn" id="testFiltersBtn">
                    <i class="ph-bold ph-play"></i>
                    Test Filters
                </button>
                <button class="action-btn secondary" id="clearTestBtn">
                    <i class="ph-bold ph-x"></i>
                    Clear
                </button>
            </div>
            <div class="test-results" id="testResults">
                <!-- Test results will be shown here -->
            </div>
        </div>
    </div>
</div>

<style>
.search-filters {
    padding: 1rem;
    max-width: 1200px;
    margin: 0 auto;
}

.analytics-header {
    margin-bottom: 2rem;
    text-align: center;
}

.page-title {
    font: normal 700 2rem/1.2 var(--_font-accent);
    color: var(--t-accent);
    background: var(--t-accent);
    background: -webkit-linear-gradient(15deg, var(--t-accent) 0%, var(--t-secondary) 80%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
}

.page-subtitle {
    font: normal 400 1.25rem/1.4 var(--_font-default);
    color: var(--t-medium);
}

/* Filters Overview */
.filters-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.overview-card {
    background: var(--base);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-l);
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all var(--_animspeed-medium) var(--_animbezier);
}

.overview-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.card-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent);
    background: -webkit-linear-gradient(315deg, var(--accent) 0%, var(--secondary) 100%);
    background: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-opp-bright);
    font-size: 1.25rem;
}

.card-content {
    flex: 1;
}

.card-value {
    font: normal 700 1.5rem/1.2 var(--_font-accent);
    color: var(--t-bright);
    margin-bottom: 0.25rem;
}

.card-label {
    font: normal 500 1rem/1.2 var(--_font-default);
    color: var(--t-medium);
    margin-bottom: 0.25rem;
}

.card-trend {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font: normal 500 0.875rem/1.2 var(--_font-default);
    color: var(--success, #10b981);
}

.card-trend.negative {
    color: var(--error, #ef4444);
}

/* Filters Tabs */
.filters-tabs {
    background: var(--base);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    margin-bottom: 2rem;
}

.tabs-header {
    display: flex;
    gap: 0.25rem;
    padding: 1rem 1.5rem 0;
    border-bottom: 1px solid var(--stroke-elements);
}

.tab-btn {
    background: none;
    border: none;
    padding: 0.75rem 1rem;
    border-bottom: 2px solid transparent;
    color: var(--t-medium);
    font: normal 600 0.875rem/1.2 var(--_font-default);
    cursor: pointer;
    transition: all var(--_animspeed-medium) var(--_animbezier);
}

.tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
}

.tabs-content {
    padding: 1.5rem;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Tab Header */
.tab-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.tab-header h3 {
    font: normal 600 1.25rem/1.2 var(--_font-accent);
    color: var(--t-bright);
    margin: 0;
}

.tab-actions {
    display: flex;
    gap: 0.75rem;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-md);
    background: var(--base);
    color: var(--t-bright);
    font: normal 600 0.875rem/1.2 var(--_font-default);
    cursor: pointer;
    transition: all var(--_animspeed-medium) var(--_animbezier);
}

.action-btn:hover {
    background: var(--accent);
    color: var(--t-opp-bright);
    border-color: var(--accent);
}

.action-btn.primary {
    background: var(--accent);
    color: var(--t-opp-bright);
    border-color: var(--accent);
}

/* Filters Grid */
.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.filter-card {
    background: var(--stroke-elements);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    padding: 1rem;
    transition: all var(--_animspeed-medium) var(--_animbezier);
}

.filter-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.filter-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.filter-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-opp-bright);
    font-size: 1rem;
}

.filter-info {
    flex: 1;
}

.filter-name {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--t-bright);
    margin-bottom: 0.25rem;
}

.filter-stats {
    font: normal 400 0.875rem/1.2 var(--_font-default);
    color: var(--t-medium);
}

.filter-actions {
    display: flex;
    gap: 0.25rem;
}

.filter-toggle {
    position: relative;
    display: inline-block;
    width: 36px;
    height: 20px;
}

.filter-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.filter-toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--stroke-elements);
    transition: 0.3s;
    border-radius: 20px;
}

.filter-toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
}

input:checked + .filter-toggle-slider {
    background-color: var(--accent);
}

input:checked + .filter-toggle-slider:before {
    transform: translateX(16px);
}

/* Filters List */
.filters-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.filter-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    transition: all var(--_animspeed-medium) var(--_animbezier);
    cursor: pointer;
}

.filter-item:hover {
    transform: translateX(2px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.filter-tag {
    padding: 0.25rem 0.75rem;
    background: var(--accent);
    color: var(--t-opp-bright);
    border-radius: var(--_radius-md);
    font: normal 500 0.875rem/1.2 var(--_font-default);
}

.filter-usage {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--accent);
}

.filter-item-actions {
    display: flex;
    gap: 0.25rem;
    margin-left: auto;
}

.filter-action {
    width: 28px;
    height: 28px;
    border: none;
    border-radius: var(--_radius-md);
    background: var(--stroke-elements);
    color: var(--t-medium);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--_animspeed-medium) var(--_animbezier);
    font-size: 0.75rem;
}

.filter-action:hover {
    background: var(--accent);
    color: var(--t-opp-bright);
}

/* Date Ranges List */
.date-ranges-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.date-range-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    background: var(--stroke-elements);
}

.date-range-info {
    flex: 1;
}

.date-range-name {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--t-bright);
    margin-bottom: 0.25rem;
}

.date-range-dates {
    font: normal 400 0.875rem/1.2 var(--_font-default);
    color: var(--t-medium);
}

.date-range-actions {
    display: flex;
    gap: 0.5rem;
}

/* Authors List */
.authors-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.author-card {
    background: var(--stroke-elements);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    padding: 1.25rem;
    text-align: center;
    transition: all var(--_animspeed-medium) var(--_animbezier);
}

.author-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.author-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--t-opp-bright);
    font-size: 1rem;
    margin: 0 auto 0.75rem;
}

.author-name {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--t-bright);
    margin-bottom: 0.25rem;
}

.author-stats {
    font: normal 400 0.875rem/1.2 var(--_font-default);
    color: var(--t-medium);
    margin-bottom: 0.75rem;
}

.author-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
}

/* Custom Filters List */
.custom-filters-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.custom-filter-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    background: var(--stroke-elements);
}

.custom-filter-info {
    flex: 1;
}

.custom-filter-name {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--t-bright);
    margin-bottom: 0.25rem;
}

.custom-filter-description {
    font: normal 400 0.875rem/1.2 var(--_font-default);
    color: var(--t-medium);
    margin-bottom: 0.25rem;
}

.custom-filter-rules {
    font: normal 400 0.875rem/1.2 var(--_font-default);
    color: var(--accent);
}

.custom-filter-actions {
    display: flex;
    gap: 0.5rem;
}

/* Filter Analytics */
.filter-analytics {
    background: var(--base);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.section-header h3 {
    font: normal 600 1.25rem/1.2 var(--_font-accent);
    color: var(--t-bright);
    margin: 0;
}

.analytics-controls select {
    padding: 0.25rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-md);
    background: var(--background);
    color: var(--t-bright);
    font-size: 0.75rem;
}

.analytics-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
}

.analytics-chart {
    height: 250px;
    position: relative;
}

.analytics-breakdown {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.breakdown-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--stroke-elements);
    border-radius: var(--_radius-md);
}

.breakdown-label {
    font: normal 500 1rem/1.2 var(--_font-default);
    color: var(--t-bright);
}

.breakdown-value {
    font: normal 600 1rem/1.2 var(--_font-default);
    color: var(--accent);
}

/* Filter Testing */
.filter-testing {
    background: var(--base);
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-lg);
    padding: 1.5rem;
}

.testing-interface {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.test-filters {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.test-filter-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.test-filter-group label {
    font: normal 500 0.875rem/1.2 var(--_font-default);
    color: var(--t-bright);
}

.test-filter-group select {
    padding: 0.5rem;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-md);
    background: var(--background);
    color: var(--t-bright);
    font-size: 0.75rem;
}

.test-filter-group select:focus {
    outline: none;
    border-color: var(--accent);
}

.test-actions {
    display: flex;
    gap: 1rem;
}

.test-results {
    min-height: 150px;
    border: 1px solid var(--stroke-elements);
    border-radius: var(--_radius-md);
    padding: 1rem;
    background: var(--stroke-elements);
    font-family: monospace;
    white-space: pre-wrap;
    font-size: 0.75rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .analytics-content {
        grid-template-columns: 1fr;
    }

    .test-filters {
        grid-template-columns: 1fr;
    }

    .tabs-header {
        flex-wrap: wrap;
    }
}

@media (max-width: 768px) {
    .search-filters {
        padding: 0.75rem;
    }

    .filters-overview {
        grid-template-columns: 1fr;
    }

    .filters-grid {
        grid-template-columns: 1fr;
    }

    .authors-list {
        grid-template-columns: 1fr;
    }

    .tab-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }

    .tab-actions {
        width: 100%;
        justify-content: center;
    }

    .section-header {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
    }

    .filter-item {
        flex-direction: column;
        text-align: center;
    }

    .date-range-item {
        flex-direction: column;
        text-align: center;
    }

    .custom-filter-item {
        flex-direction: column;
        text-align: center;
    }

    .author-card {
        text-align: center;
    }

    .breakdown-item {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }

    .test-actions {
        flex-direction: column;
    }
}
</style>

<script>
// Search Filters Configuration
document.addEventListener('DOMContentLoaded', function() {
    initSearchFilters();
});

function initSearchFilters() {
    loadFiltersData();
    initTabNavigation();
    initTestingInterface();
}

async function loadFiltersData() {
    try {
        const response = await fetch('/api/admin/search/filters');
        if (response.ok) {
            const data = await response.json();
            updateFiltersOverview(data.overview);
            updateSectionsGrid(data.sections);
            updateTagsList(data.tags);
            updateDateRangesList(data.dateRanges);
            updateAuthorsList(data.authors);
            updateCustomFiltersList(data.customFilters);
            updateFilterAnalytics(data.analytics);
            populateTestFilters(data);
        }
    } catch (error) {
        console.error('Error loading filters data:', error);
        showFallbackFiltersData();
    }
}

function updateFiltersOverview(data) {
    document.getElementById('activeFilters').textContent = data.activeFilters;
    document.getElementById('filterUsage').textContent = data.filterUsage + '%';
    document.getElementById('filterPrecision').textContent = data.filterPrecision + '%';
    document.getElementById('avgFilterTime').textContent = Math.round(data.avgFilterTime * 1000) + 'ms';

    updateTrend('filtersTrend', data.filtersChange);
    updateTrend('usageTrend', data.usageChange);
    updateTrend('precisionTrend', data.precisionChange);
    updateTrend('filterTimeTrend', data.timeChange);
}

function updateTrend(elementId, change) {
    const element = document.getElementById(elementId);
    const span = element.querySelector('span');
    const icon = element.querySelector('i');

    span.textContent = (change >= 0 ? '+' : '') + Math.abs(change).toFixed(1) + '%';

    if (change < 0) {
        element.classList.add('negative');
        icon.className = 'ph-bold ph-trend-down';
    } else {
        element.classList.remove('negative');
        icon.className = 'ph-bold ph-trend-up';
    }
}

function updateSectionsGrid(sections) {
    const container = document.getElementById('sectionsGrid');
    container.innerHTML = sections.map(section => `
        <div class="filter-card">
            <div class="filter-header">
                <div class="filter-icon">
                    <i class="ph-bold ${section.icon}"></i>
                </div>
                <div class="filter-info">
                    <div class="filter-name">${section.name}</div>
                    <div class="filter-stats">${section.postCount} posts • ${section.usage}% used</div>
                </div>
                <div class="filter-actions">
                    <label class="filter-toggle">
                        <input type="checkbox" ${section.enabled ? 'checked' : ''} onchange="toggleSection('${section.id}', this.checked)">
                        <span class="filter-toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
    `).join('');
}

function updateTagsList(tags) {
    const container = document.getElementById('tagsList');
    container.innerHTML = tags.map(tag => `
        <div class="filter-item">
            <div class="filter-tag">${tag.name}</div>
            <div class="filter-usage">${tag.usage}% used</div>
            <div class="filter-item-actions">
                <button class="filter-action" onclick="editTag('${tag.id}')" title="Edit">
                    <i class="ph-bold ph-pencil"></i>
                </button>
                <button class="filter-action" onclick="deleteTag('${tag.id}')" title="Delete">
                    <i class="ph-bold ph-trash"></i>
                </button>
            </div>
        </div>
    `).join('');
}

function updateDateRangesList(ranges) {
    const container = document.getElementById('dateRangesList');
    container.innerHTML = ranges.map(range => `
        <div class="date-range-item">
            <div class="date-range-info">
                <div class="date-range-name">${range.name}</div>
                <div class="date-range-dates">${range.startDate} - ${range.endDate}</div>
            </div>
            <div class="date-range-actions">
                <button class="custom-action-btn" onclick="editDateRange('${range.id}')">Edit</button>
                <button class="custom-action-btn danger" onclick="deleteDateRange('${range.id}')">Delete</button>
            </div>
        </div>
    `).join('');
}

function updateAuthorsList(authors) {
    const container = document.getElementById('authorsList');
    container.innerHTML = authors.map(author => `
        <div class="author-card">
            <div class="author-avatar">
                <i class="ph-bold ph-user"></i>
            </div>
            <div class="author-name">${author.name}</div>
            <div class="author-stats">${author.postCount} posts • ${author.usage}% used</div>
            <div class="author-actions">
                <label class="filter-toggle">
                    <input type="checkbox" ${author.enabled ? 'checked' : ''} onchange="toggleAuthor('${author.id}', this.checked)">
                    <span class="filter-toggle-slider"></span>
                </label>
            </div>
        </div>
    `).join('');
}

function updateCustomFiltersList(filters) {
    const container = document.getElementById('customFiltersList');
    container.innerHTML = filters.map(filter => `
        <div class="custom-filter-item">
            <div class="custom-filter-info">
                <div class="custom-filter-name">${filter.name}</div>
                <div class="custom-filter-description">${filter.description}</div>
                <div class="custom-filter-rules">${filter.rules}</div>
            </div>
            <div class="custom-filter-actions">
                <button class="custom-action-btn" onclick="editCustomFilter('${filter.id}')">Edit</button>
                <button class="custom-action-btn danger" onclick="deleteCustomFilter('${filter.id}')">Delete</button>
            </div>
        </div>
    `).join('');
}

function updateFilterAnalytics(analytics) {
    // Update chart
    const ctx = document.getElementById('filterUsageChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: analytics.labels,
            datasets: [{
                label: 'Filter Usage',
                data: analytics.usage,
                backgroundColor: 'var(--accent)',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Update breakdown
    const breakdownContainer = document.getElementById('filterBreakdown');
    breakdownContainer.innerHTML = analytics.breakdown.map(item => `
        <div class="breakdown-item">
            <div class="breakdown-label">${item.filter}</div>
            <div class="breakdown-value">${item.usage}%</div>
        </div>
    `).join('');
}

function populateTestFilters(data) {
    // Populate test filter options
    const sectionSelect = document.getElementById('testSection');
    sectionSelect.innerHTML = '<option value="">All Sections</option>' +
        data.sections.filter(s => s.enabled).map(s => `<option value="${s.id}">${s.name}</option>`).join('');

    const tagSelect = document.getElementById('testTags');
    tagSelect.innerHTML = data.tags.map(t => `<option value="${t.id}">${t.name}</option>`).join('');

    const dateSelect = document.getElementById('testDateRange');
    dateSelect.innerHTML = '<option value="">Any Time</option>' +
        data.dateRanges.map(r => `<option value="${r.id}">${r.name}</option>`).join('');

    const authorSelect = document.getElementById('testAuthor');
    authorSelect.innerHTML = '<option value="">Any Author</option>' +
        data.authors.filter(a => a.enabled).map(a => `<option value="${a.id}">${a.name}</option>`).join('');
}

function initTabNavigation() {
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            const targetContent = document.getElementById(this.dataset.tab + '-tab');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        });
    });

    // Tab-specific event listeners
    document.getElementById('refreshSectionsBtn').addEventListener('click', refreshSections);
    document.getElementById('addSectionBtn').addEventListener('click', () => showAddSectionModal());
    document.getElementById('autoGenerateTagsBtn').addEventListener('click', autoGenerateTags);
    document.getElementById('addTagBtn').addEventListener('click', () => showAddTagModal());
    document.getElementById('addDateRangeBtn').addEventListener('click', () => showAddDateRangeModal());
    document.getElementById('syncAuthorsBtn').addEventListener('click', syncAuthors);
    document.getElementById('createCustomFilterBtn').addEventListener('click', () => showCreateCustomFilterModal());

    document.getElementById('analyticsPeriod').addEventListener('change', function() {
        loadFilterAnalytics(this.value);
    });
}

function initTestingInterface() {
    document.getElementById('testFiltersBtn').addEventListener('click', testFilters);
    document.getElementById('clearTestBtn').addEventListener('click', clearTest);
}

// Action functions
async function refreshSections() {
    showNotification('Refreshing sections...', 'info');
    try {
        const response = await fetch('/api/admin/search/filters/refresh-sections', { method: 'POST' });
        if (response.ok) {
            loadFiltersData();
            showNotification('Sections refreshed successfully', 'success');
        } else {
            showNotification('Failed to refresh sections', 'error');
        }
    } catch (error) {
        console.error('Error refreshing sections:', error);
        showNotification('Error refreshing sections', 'error');
    }
}

async function toggleSection(sectionId, enabled) {
    try {
        const response = await fetch(`/api/admin/search/filters/section/${sectionId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ enabled })
        });
        if (response.ok) {
            showNotification(`Section ${enabled ? 'enabled' : 'disabled'}`, 'success');
        } else {
            showNotification('Failed to update section', 'error');
        }
    } catch (error) {
        console.error('Error updating section:', error);
        showNotification('Error updating section', 'error');
    }
}

async function autoGenerateTags() {
    showNotification('Auto-generating tags...', 'info');
    try {
        const response = await fetch('/api/admin/search/filters/auto-generate-tags', { method: 'POST' });
        if (response.ok) {
            loadFiltersData();
            showNotification('Tags auto-generated successfully', 'success');
        } else {
            showNotification('Failed to auto-generate tags', 'error');
        }
    } catch (error) {
        console.error('Error auto-generating tags:', error);
        showNotification('Error auto-generating tags', 'error');
    }
}

async function syncAuthors() {
    showNotification('Syncing authors...', 'info');
    try {
        const response = await fetch('/api/admin/search/filters/sync-authors', { method: 'POST' });
        if (response.ok) {
            loadFiltersData();
            showNotification('Authors synced successfully', 'success');
        } else {
            showNotification('Failed to sync authors', 'error');
        }
    } catch (error) {
        console.error('Error syncing authors:', error);
        showNotification('Error syncing authors', 'error');
    }
}

async function testFilters() {
    const filters = {
        section: document.getElementById('testSection').value,
        tags: Array.from(document.getElementById('testTags').selectedOptions).map(opt => opt.value),
        dateRange: document.getElementById('testDateRange').value,
        author: document.getElementById('testAuthor').value
    };

    showNotification('Testing filters...', 'info');

    try {
        const response = await fetch('/api/admin/search/filters/test', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(filters)
        });

        if (response.ok) {
            const result = await response.json();
            displayTestResults(result);
        } else {
            showNotification('Failed to test filters', 'error');
        }
    } catch (error) {
        console.error('Error testing filters:', error);
        showNotification('Error testing filters', 'error');
    }
}

function displayTestResults(result) {
    const container = document.getElementById('testResults');
    container.textContent = JSON.stringify(result, null, 2);
}

function clearTest() {
    document.getElementById('testSection').value = '';
    document.getElementById('testTags').value = '';
    document.getElementById('testDateRange').value = '';
    document.getElementById('testAuthor').value = '';
    document.getElementById('testResults').textContent = '';
}

// Modal functions (placeholders)
function showAddSectionModal() {
    showNotification('Add section modal would open here', 'info');
}

function showAddTagModal() {
    showNotification('Add tag modal would open here', 'info');
}

function showAddDateRangeModal() {
    showNotification('Add date range modal would open here', 'info');
}

function showCreateCustomFilterModal() {
    showNotification('Create custom filter modal would open here', 'info');
}

async function loadFilterAnalytics(period) {
    try {
        const response = await fetch(`/api/admin/search/filters/analytics?period=${period}`);
        if (response.ok) {
            const data = await response.json();
            updateFilterAnalytics(data);
        }
    } catch (error) {
        console.error('Error loading filter analytics:', error);
    }
}

function showNotification(message, type = 'info') {
    // Use global notification system
    console.log(`${type.toUpperCase()}: ${message}`);
}

function showFallbackFiltersData() {
    // Show sample data when API is not available
    updateFiltersOverview({
        activeFilters: 12,
        filterUsage: 67.5,
        filterPrecision: 89.2,
        avgFilterTime: 0.023,
        filtersChange: 5.2,
        usageChange: 8.7,
        precisionChange: 3.1,
        timeChange: -2.4
    });
}
</script>