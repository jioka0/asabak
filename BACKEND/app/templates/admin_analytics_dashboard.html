<!-- Tailwind Configuration Script -->
<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        'syne': ['Syne', 'sans-serif'],
      },
      colors: {
        'base': 'var(--base)',
        'base-tint': 'var(--base-tint)',
        'base-shade': 'var(--base-shade)',
        'accent': 'var(--accent)',
        'secondary': 'var(--secondary)',
        'secondary-rgba': 'var(--secondary-rgba)',
        'stroke-controls': 'var(--stroke-controls)',
        'stroke-elements': 'var(--stroke-elements)',
        't-bright': 'var(--t-bright)',
        't-medium': 'var(--t-medium)',
        't-muted': 'var(--t-muted)',
        't-accent': 'var(--t-accent)',
        't-secondary': 'var(--t-secondary)',
        't-disabled': 'var(--t-disabled)',
        't-placeholder': 'var(--t-placeholder)',
        'base-opp': 'var(--base-opp)',
        't-opp-bright': 'var(--t-opp-bright)',
        't-opp-medium': 'var(--t-opp-medium)',
        't-opp-muted': 'var(--t-opp-muted)',
        'gradient-one': 'var(--gradient-one)',
        'gradient-two': 'var(--gradient-two)',
        'gradient-three': 'var(--gradient-three)',
      },
      borderRadius: {
        's': 'var(--_radius-s)',
        'm': 'var(--_radius-m)',
        'l': 'var(--_radius-l)',
        'xl': 'var(--_radius-xl)',
      },
      animation: {
        'fade-in': 'fadeIn 0.6s ease-out forwards',
        'slide-up': 'slideUp 0.6s ease-out forwards',
        'scale-in': 'scaleIn 0.4s ease-out forwards',
      },
      transitionTimingFunction: {
        'bezier': 'var(--_animbezier)',
      },
      transitionDuration: {
        'fast': 'var(--_animspeed-fast)',
        'medium': 'var(--_animspeed-medium)',
        'slow': 'var(--_animspeed-slow)',
      },
    },
  },
}
</script>

<div class="min-h-screen bg-gradient-to-br from-gradient-one via-base to-gradient-two dark:from-base dark:via-base-tint dark:to-base-shade transition-all duration-medium">
    <div class="p-6 md:p-8 lg:p-12">
        <!-- Page Header -->
        <div class="text-center mb-12 p-12 bg-gradient-to-r from-accent via-secondary to-t-accent rounded-xl text-t-opp-bright shadow-2xl hover:shadow-3xl transform hover:scale-[1.01] transition-all duration-medium relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-accent/20 via-transparent to-secondary/20 animate-pulse"></div>
            <div class="relative z-10">
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight font-syne bg-gradient-to-r from-t-opp-bright via-white to-t-opp-medium bg-clip-text text-transparent">Analytics Dashboard</h1>
                <p class="text-xl md:text-2xl opacity-90 font-syne font-light">Monitor your blog's performance and user engagement</p>
                <div class="mt-8 flex justify-center">
                    <div class="w-24 h-1 bg-gradient-to-r from-transparent via-t-opp-bright to-transparent rounded-full"></div>
                </div>
            </div>
        </div>

        <!-- Key Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-8 mb-12">
            <!-- Total Views Card -->
            <div class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-accent/20 cursor-pointer overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-accent/5 via-transparent to-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium"></div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-accent via-secondary to-t-accent rounded-xl flex items-center justify-center text-t-opp-bright text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-eye"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="totalViews">0</div>
                        <div class="text-base text-t-medium font-syne mb-3">Total Views</div>
                        <div class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400" id="viewsChange">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+12.5%</span>
                            <span class="text-t-muted font-syne">vs last month</span>
                        </div>
                    </div>
                </div>
                <div class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-accent/10 to-secondary/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium"></div>
            </div>

            <!-- Unique Visitors Card -->
            <div class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-emerald-500/20 cursor-pointer overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-teal-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium"></div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-emerald-500 via-teal-500 to-green-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-users"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="uniqueVisitors">0</div>
                        <div class="text-base text-t-medium font-syne mb-3">Unique Visitors</div>
                        <div class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400" id="visitorsChange">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+8.2%</span>
                            <span class="text-t-muted font-syne">vs last month</span>
                        </div>
                    </div>
                </div>
                <div class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-emerald-500/10 to-teal-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium"></div>
            </div>

            <!-- Avg Session Time Card -->
            <div class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-blue-500/20 cursor-pointer overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 via-transparent to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium"></div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-clock"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="avgSessionTime">0m</div>
                        <div class="text-base text-t-medium font-syne mb-3">Avg. Session Time</div>
                        <div class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400" id="sessionChange">
                            <i class="ph-bold ph-trend-up text-base"></i>
                            <span>+15.3%</span>
                            <span class="text-t-muted font-syne">vs last month</span>
                        </div>
                    </div>
                </div>
                <div class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-blue-500/10 to-indigo-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium"></div>
            </div>

            <!-- Bounce Rate Card -->
            <div class="group relative bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl p-8 hover:scale-105 hover:-translate-y-2 transition-all duration-medium shadow-xl hover:shadow-2xl hover:shadow-yellow-500/20 cursor-pointer overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-yellow-500/5 via-transparent to-amber-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-medium"></div>
                <div class="relative z-10 flex items-center space-x-6">
                    <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 via-amber-500 to-orange-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg group-hover:shadow-xl transition-all duration-medium">
                        <i class="ph-bold ph-trend-up"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-t-bright font-syne mb-1" id="bounceRate">0%</div>
                        <div class="text-base text-t-medium font-syne mb-3">Bounce Rate</div>
                        <div class="flex items-center space-x-2 text-sm font-semibold text-green-500 dark:text-green-400" id="bounceChange">
                            <i class="ph-bold ph-trend-down text-base"></i>
                            <span>-5.1%</span>
                            <span class="text-t-muted font-syne">vs last month</span>
                        </div>
                    </div>
                </div>
                <div class="absolute -bottom-2 -right-2 w-20 h-20 bg-gradient-to-br from-yellow-500/10 to-amber-500/10 rounded-full blur-xl group-hover:blur-2xl transition-all duration-medium"></div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-8 mb-12">
            <!-- Traffic Overview Chart -->
            <div class="xl:col-span-2 bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl overflow-hidden hover:shadow-3xl transition-all duration-medium">
                <div class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                    <div class="flex flex-col xl:flex-row xl:items-center xl:justify-between space-y-6 xl:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                                <i class="ph-bold ph-bar-chart text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-t-bright font-syne">Traffic Overview</h3>
                                <p class="text-t-medium font-syne text-sm">Page views and unique visitors over time</p>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button class="inline-flex items-center justify-center space-x-3 px-6 py-3 bg-accent/10 hover:bg-accent/20 text-accent font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-medium font-syne text-sm" data-period="7d">
                                <span>7D</span>
                            </button>
                            <button class="inline-flex items-center justify-center space-x-3 px-6 py-3 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements text-t-bright font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-medium font-syne text-sm active" data-period="30d">
                                <span>30D</span>
                            </button>
                            <button class="inline-flex items-center justify-center space-x-3 px-6 py-3 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements text-t-bright font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-medium font-syne text-sm" data-period="90d">
                                <span>90D</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-8">
                    <div class="h-80 relative">
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Popular Content -->
            <div class="bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl overflow-hidden hover:shadow-3xl transition-all duration-medium">
                <div class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                    <div class="flex flex-col xl:flex-row xl:items-center xl:justify-between space-y-6 xl:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                                <i class="ph-bold ph-star text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-t-bright font-syne">Popular Content</h3>
                                <p class="text-t-medium font-syne text-sm">Top performing articles</p>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button class="inline-flex items-center justify-center space-x-3 px-6 py-3 bg-accent/10 hover:bg-accent/20 text-accent font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-medium font-syne text-sm active" data-type="views">
                                <span>Views</span>
                            </button>
                            <button class="inline-flex items-center justify-center space-x-3 px-6 py-3 bg-base-tint dark:bg-base-shade hover:bg-base-shade dark:hover:bg-base border border-stroke-elements text-t-bright font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-medium font-syne text-sm" data-type="engagement">
                                <span>Engagement</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-8">
                    <div class="space-y-4 max-h-80 overflow-y-auto" id="popularContent">
                        <!-- Content items will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
            <!-- Device Breakdown -->
            <div class="bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl overflow-hidden hover:shadow-3xl transition-all duration-medium">
                <div class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                            <i class="ph-bold ph-device-mobile text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-t-bright font-syne">Device Breakdown</h3>
                            <p class="text-t-medium font-syne text-sm">Traffic by device type</p>
                        </div>
                    </div>
                </div>
                <div class="p-8">
                    <div class="h-64 relative">
                        <canvas id="deviceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Top Referrers -->
            <div class="bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl overflow-hidden hover:shadow-3xl transition-all duration-medium">
                <div class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                            <i class="ph-bold ph-link text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-t-bright font-syne">Top Referrers</h3>
                            <p class="text-t-medium font-syne text-sm">Traffic sources</p>
                        </div>
                    </div>
                </div>
                <div class="p-8">
                    <div class="space-y-4 max-h-64 overflow-y-auto" id="topReferrers">
                        <!-- Referrer items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Search Analytics -->
            <div class="bg-base/90 dark:bg-base-tint/90 backdrop-blur-xl border border-stroke-elements rounded-xl shadow-2xl overflow-hidden hover:shadow-3xl transition-all duration-medium">
                <div class="bg-gradient-to-r from-base-tint to-base-shade dark:from-base-shade dark:to-base p-8 border-b border-stroke-elements">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-accent to-secondary rounded-xl flex items-center justify-center text-t-opp-bright shadow-lg">
                            <i class="ph-bold ph-magnifying-glass text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-t-bright font-syne">Search Analytics</h3>
                            <p class="text-t-medium font-syne text-sm">Search performance metrics</p>
                        </div>
                    </div>
                </div>
                <div class="p-8">
                    <div class="space-y-6">
                        <div class="text-center p-4 bg-base-tint/50 dark:bg-base-shade/50 rounded-xl border border-stroke-elements">
                            <div class="text-3xl font-bold text-accent font-syne mb-2" id="totalSearches">0</div>
                            <div class="text-sm text-t-medium font-syne">Total Searches</div>
                        </div>
                        <div class="text-center p-4 bg-base-tint/50 dark:bg-base-shade/50 rounded-xl border border-stroke-elements">
                            <div class="text-3xl font-bold text-green-500 font-syne mb-2" id="searchSuccessRate">0%</div>
                            <div class="text-sm text-t-medium font-syne">Success Rate</div>
                        </div>
                        <div class="text-center p-4 bg-base-tint/50 dark:bg-base-shade/50 rounded-xl border border-stroke-elements">
                            <div class="text-3xl font-bold text-blue-500 font-syne mb-2" id="popularSearchTerm">-</div>
                            <div class="text-sm text-t-medium font-syne">Popular Term</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom CSS for enhanced animations and effects -->
<style>
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes glow {
  0%, 100% {
    box-shadow: 0 0 20px rgba(var(--accent), 0.3);
  }
  50% {
    box-shadow: 0 0 30px rgba(var(--accent), 0.6);
  }
}

.animate-fade-in-up {
  animation: fadeInUp 0.6s ease-out forwards;
}

.animate-scale-in {
  animation: scaleIn 0.4s ease-out forwards;
}

.animate-glow {
  animation: glow 2s ease-in-out infinite;
}

/* Enhanced scrollbar */
.overflow-x-auto::-webkit-scrollbar,
.overflow-y-auto::-webkit-scrollbar {
  width: 8px;
}

.overflow-x-auto::-webkit-scrollbar-track,
.overflow-y-auto::-webkit-scrollbar-track {
  background: var(--base-tint);
  border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb,
.overflow-y-auto::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb:hover,
.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: var(--secondary);
}

/* Enhanced focus states */
.focus\:ring-accent:focus {
  --tw-ring-color: var(--accent);
}

/* Smooth transitions for all interactive elements */
button, input, select, .cursor-pointer {
  transition: all var(--_animspeed-medium) var(--_animbezier);
}

/* Enhanced hover effects */
.hover\:glow:hover {
  animation: glow 0.6s ease-out;
}

/* Content item styles */
.content-item {
  @apply flex items-center gap-4 p-4 rounded-xl transition-all duration-medium hover:bg-base-tint/30 dark:hover:bg-base-shade/30;
}

.content-rank {
  @apply w-8 h-8 rounded-full bg-gradient-to-br from-accent to-secondary text-t-opp-bright flex items-center justify-center font-bold text-sm shadow-lg;
}

.content-info {
  @apply flex-1;
}

.content-title {
  @apply text-sm font-semibold text-t-bright font-syne mb-1 group-hover:text-accent transition-colors duration-medium;
}

.content-stats {
  @apply text-xs text-t-medium font-syne;
}

/* Referrer item styles */
.referrer-item {
  @apply flex items-center justify-between p-4 rounded-xl transition-all duration-medium hover:bg-base-tint/30 dark:hover:bg-base-shade/30;
}

.referrer-name {
  @apply text-sm font-semibold text-t-bright font-syne group-hover:text-accent transition-colors duration-medium;
}

.referrer-count {
  @apply text-sm font-bold text-accent font-syne;
}

/* Button active states */
.active {
  @apply bg-accent/10 text-accent;
}
</style>

<script>
// Analytics Dashboard JavaScript
document.addEventListener('DOMContentLoaded', function() {
    initAnalyticsDashboard();
});

function initAnalyticsDashboard() {
    loadAnalyticsData();
    initChartControls();
    initContentTypeControls();
}

function loadAnalyticsData() {
    // Load analytics data from API
    fetch('/api/analytics/dashboard')
        .then(response => response.json())
        .then(data => {
            updateMetrics(data.metrics);
            updateTrafficChart(data.traffic);
            updatePopularContent(data.content);
            updateDeviceChart(data.devices);
            updateTopReferrers(data.referrers);
            updateSearchStats(data.search);
        })
        .catch(error => {
            console.error('Error loading analytics data:', error);
            showFallbackData();
        });
}

function updateMetrics(metrics) {
    document.getElementById('totalViews').textContent = metrics.totalViews.toLocaleString();
    document.getElementById('uniqueVisitors').textContent = metrics.uniqueVisitors.toLocaleString();
    document.getElementById('avgSessionTime').textContent = formatDuration(metrics.avgSessionTime);
    document.getElementById('bounceRate').textContent = metrics.bounceRate + '%';

    updateMetricChange('viewsChange', metrics.viewsChange);
    updateMetricChange('visitorsChange', metrics.visitorsChange);
    updateMetricChange('sessionChange', metrics.sessionChange);
    updateMetricChange('bounceChange', metrics.bounceChange);
}

function updateMetricChange(elementId, change) {
    const element = document.getElementById(elementId);
    const valueElement = element.querySelector('.change-value');
    valueElement.textContent = (change >= 0 ? '+' : '') + change.toFixed(1) + '%';
    if (change < 0) {
        valueElement.classList.add('negative');
    }
}

function updateTrafficChart(trafficData) {
    const ctx = document.getElementById('trafficChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: trafficData.labels,
            datasets: [{
                label: 'Page Views',
                data: trafficData.views,
                borderColor: 'var(--accent)',
                backgroundColor: 'rgba(124, 58, 237, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Unique Visitors',
                data: trafficData.visitors,
                borderColor: 'var(--secondary)',
                backgroundColor: 'rgba(236, 72, 153, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function updatePopularContent(contentData) {
    const container = document.getElementById('popularContent');
    container.innerHTML = contentData.map((item, index) => `
        <div class="content-item">
            <div class="content-rank">${index + 1}</div>
            <div class="content-info">
                <div class="content-title">${item.title}</div>
                <div class="content-stats">${item.views.toLocaleString()} views â€¢ ${item.engagement}% engagement</div>
            </div>
        </div>
    `).join('');
}

function updateDeviceChart(deviceData) {
    const ctx = document.getElementById('deviceChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: deviceData.labels,
            datasets: [{
                data: deviceData.values,
                backgroundColor: [
                    'var(--accent)',
                    'var(--secondary)',
                    'var(--success, #10b981)',
                    'var(--warning, #f59e0b)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });
}

function updateTopReferrers(referrerData) {
    const container = document.getElementById('topReferrers');
    container.innerHTML = referrerData.map(item => `
        <div class="referrer-item">
            <div class="referrer-name">${item.name}</div>
            <div class="referrer-count">${item.count.toLocaleString()}</div>
        </div>
    `).join('');
}

function updateSearchStats(searchData) {
    document.getElementById('totalSearches').textContent = searchData.total.toLocaleString();
    document.getElementById('searchSuccessRate').textContent = searchData.successRate + '%';
    document.getElementById('popularSearchTerm').textContent = searchData.popularTerm;
}

function initChartControls() {
    document.querySelectorAll('.chart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            loadAnalyticsData(this.dataset.period);
        });
    });
}

function initContentTypeControls() {
    document.querySelectorAll('.content-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.content-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            loadPopularContent(this.dataset.type);
        });
    });
}

function formatDuration(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes}m ${remainingSeconds}s`;
}

function showFallbackData() {
    // Show sample data when API is not available
    updateMetrics({
        totalViews: 12543,
        uniqueVisitors: 8921,
        avgSessionTime: 184,
        bounceRate: 42.3,
        viewsChange: 12.5,
        visitorsChange: 8.2,
        sessionChange: 15.3,
        bounceChange: -5.1
    });
}
</script>